<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notification & Multi-Channel Alerts</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        brand: {
                            50: '#f0f9ff',
                            100: '#e0f2fe',
                            500: '#0ea5e9',
                            600: '#0284c7',
                            700: '#0369a1',
                            900: '#0c4a6e',
                        },
                        slate: {
                            850: '#1e293b',
                            900: '#0f172a',
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    }
                }
            }
        }
        window.FontAwesomeConfig = { autoReplaceSvg: 'nest'};
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.plot.ly/plotly-3.1.1.min.js"></script>
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; }
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        .toggle-checkbox:checked { right: 0; border-color: #0ea5e9; }
        .toggle-checkbox:checked + .toggle-label { background-color: #0ea5e9; }
        
        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        .modal-content {
            background-color: white;
            border-radius: 12px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            transform: translateY(-20px);
            transition: transform 0.3s ease;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        
        .modal-overlay.active .modal-content {
            transform: translateY(0);
        }
        
        .modal-header {
            padding: 20px 24px;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-body {
            padding: 24px;
        }
        
        .modal-footer {
            padding: 20px 24px;
            border-top: 1px solid #e2e8f0;
            display: flex;
            justify-content: flex-end;
            gap: 12px;
        }
        
        /* Toast Notification */
        .toast {
            position: fixed;
            bottom: 24px;
            right: 24px;
            background: white;
            border-radius: 8px;
            padding: 16px 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            gap: 12px;
            z-index: 999;
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s ease;
            min-width: 320px;
            border-left: 4px solid #10b981;
        }
        
        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }
        
        .toast-error { border-left-color: #ef4444; }
        .toast-warning { border-left-color: #f59e0b; }
        .toast-info { border-left-color: #0ea5e9; }
        
        /* Sidebar Styles */
        .sidebar {
            width: 260px;
            background: #0f172a;
            height: 100vh;
            overflow-y: auto;
            position: fixed;
            left: 0;
            top: 0;
            z-index: 40;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
        }
        
        .sidebar-logo {
            height: 64px;
            display: flex;
            align-items: center;
            padding: 0 20px;
            border-bottom: 1px solid #1e293b;
            background: #0f172a;
        }
        
        .logo-text {
            font-weight: 700;
            font-size: 18px;
            color: white;
        }
        
        .sidebar-nav {
            flex: 1;
            padding: 16px 0;
            overflow-y: auto;
        }
        
        .nav-section {
            margin-bottom: 24px;
        }
        
        .section-title {
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: #94a3b8;
            padding: 0 20px 8px;
            margin-bottom: 4px;
            border-bottom: 1px solid #1e293b;
        }
        
        .nav-item {
            display: flex;
            align-items: center;
            padding: 8px 20px;
            color: #cbd5e1;
            text-decoration: none;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
            border-left: 3px solid transparent;
            cursor: pointer;
        }
        
        .nav-item:hover {
            background: #1e293b;
            color: white;
        }
        
        .nav-item.active {
            background: #1e293b;
            color: white;
            border-left-color: #0ea5e9;
            font-weight: 600;
        }
        
        .nav-item i {
            width: 20px;
            margin-right: 12px;
            font-size: 14px;
            text-align: center;
        }
        
        .nav-item-count {
            margin-left: auto;
            background: #334155;
            color: #cbd5e1;
            font-size: 12px;
            padding: 2px 8px;
            border-radius: 10px;
            font-weight: 500;
        }
        
        .sidebar-footer {
            padding: 16px 20px;
            border-top: 1px solid #1e293b;
            background: #0f172a;
        }
        
        .user-profile {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .user-avatar {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            background: #0ea5e9;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
        }
        
        .sidebar-toggle {
            display: none;
            position: fixed;
            left: 260px;
            top: 20px;
            z-index: 100;
            background: white;
            border: 1px solid #e2e8f0;
            border-left: none;
            border-radius: 0 6px 6px 0;
            padding: 10px 8px;
            cursor: pointer;
            color: #64748b;
            transition: all 0.3s;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .sidebar.collapsed {
            transform: translateX(-260px);
        }
        
        .sidebar.collapsed ~ .main-content-with-sidebar {
            margin-left: 0;
        }
        
        .sidebar.collapsed + .sidebar-toggle {
            left: 0;
        }
        
        .main-content-with-sidebar {
            margin-left: 260px;
            transition: margin-left 0.3s;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        @media (max-width: 1024px) {
            .sidebar {
                transform: translateX(-260px);
            }
            
            .sidebar.active {
                transform: translateX(0);
                box-shadow: 0 0 20px rgba(0,0,0,0.1);
            }
            
            .sidebar-toggle {
                display: block;
                left: 0;
            }
            
            .sidebar.active + .sidebar-toggle {
                left: 260px;
            }
            
            .main-content-with-sidebar {
                margin-left: 0;
            }
        }
        
        /* Toggle Switch */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 44px;
            height: 24px;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #cbd5e1;
            transition: .4s;
            border-radius: 34px;
        }
        
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .toggle-slider {
            background-color: #0ea5e9;
        }
        
        input:checked + .toggle-slider:before {
            transform: translateX(20px);
        }
        
        /* Tab Styles */
        .tab-button {
            padding: 10px 20px;
            border-bottom: 2px solid transparent;
            transition: all 0.2s ease;
            font-weight: 500;
        }
        
        .tab-button:hover {
            color: #0ea5e9;
            border-bottom-color: #cbd5e1;
        }
        
        .tab-button.active {
            color: #0ea5e9;
            border-bottom-color: #0ea5e9;
            font-weight: 600;
        }
        
        /* Log Table Styles */
        .log-row {
            transition: background-color 0.2s ease;
        }
        
        .log-row:hover {
            background-color: #f8fafc;
        }
        
        .status-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .status-sent {
            background-color: #dbeafe;
            color: #1e40af;
        }
        
        .status-delivered {
            background-color: #dcfce7;
            color: #166534;
        }
        
        .status-failed {
            background-color: #fee2e2;
            color: #991b1b;
        }
        
        .status-pending {
            background-color: #fef3c7;
            color: #92400e;
        }
    </style>
</head>
<body class="text-slate-800 h-screen flex flex-col overflow-hidden">

    <!-- Sidebar will be inserted here by JavaScript -->
    <div id="sidebar-container"></div>

    <!-- Modal Overlay -->
    <div id="modal-overlay" class="modal-overlay">
        <div id="modal-content" class="modal-content">
            <!-- Modal content will be inserted here -->
        </div>
    </div>

    <!-- Toast Notification Container -->
    <div id="toast-container"></div>

    <!-- Confirmation Dialog Overlay -->
    <div id="confirmation-overlay" class="modal-overlay">
        <div id="confirmation-dialog" class="confirmation-dialog">
            <!-- Confirmation content will be inserted here -->
        </div>
    </div>

    <!-- Main Content Container -->
    <div class="main-content-with-sidebar">
        <!-- HEADER -->
        <header id="header" class="bg-white border-b border-slate-200 h-16 flex items-center justify-between px-6 shrink-0 z-20">
            <div class="flex items-center gap-4">
                <div class="flex items-center gap-2 text-brand-700 font-bold text-xl">
                    <i class="fa-solid fa-network-wired"></i>
                    <span>Innospace</span>
                </div>
                <div class="h-6 w-px bg-slate-300 mx-2"></div>
                <nav class="flex items-center text-sm text-slate-500">
                    <span>Univa Gateway Config</span>
                    <i class="fa-solid fa-chevron-right text-xs mx-2"></i>
                    <span class="text-slate-800 font-medium">Notification & Multi-Channel Alerts</span>
                </nav>
            </div>
            
            <div class="flex items-center gap-4">
                <div class="flex items-center gap-2 bg-slate-100 rounded-md px-3 py-1.5 border border-slate-200">
                    <span class="text-xs text-slate-500 font-semibold uppercase">Gateway</span>
                    <select id="gateway-select" class="bg-transparent text-sm font-medium text-slate-700 focus:outline-none cursor-pointer">
                        <option>Univa-GW-01</option>
                        <option>Univa-GW-02</option>
                        <option>Univa-GW-HQ</option>
                    </select>
                </div>
                <div class="flex items-center gap-2">
                    <button class="px-4 py-1.5 text-sm font-medium text-slate-600 hover:text-slate-800 hover:bg-slate-100 rounded-md transition-colors" onclick="resetConfiguration()">Reset</button>
                    <button class="px-4 py-1.5 text-sm font-medium text-slate-600 hover:text-slate-800 hover:bg-slate-100 rounded-md transition-colors" onclick="cancelChanges()">Cancel</button>
                    <button class="px-4 py-1.5 text-sm font-medium text-white bg-brand-600 hover:bg-brand-700 rounded-md shadow-sm transition-colors" onclick="saveConfiguration()">
                        <i class="fa-solid fa-save mr-1"></i> Save Config
                    </button>
                </div>
            </div>
        </header>

        <!-- MAIN NAVIGATION TABS -->
        <div class="bg-white border-b border-slate-200">
            <div class="max-w-7xl mx-auto px-6">
                <div class="flex space-x-6">
                    <button id="tab-channels" class="tab-button active" onclick="switchTab('channels')">
                        <i class="fa-solid fa-share-nodes mr-2"></i> Configure Channels
                    </button>
                    <button id="tab-templates" class="tab-button" onclick="switchTab('templates')">
                        <i class="fa-solid fa-file-lines mr-2"></i> Templates
                    </button>
                    <button id="tab-routing" class="tab-button" onclick="switchTab('routing')">
                        <i class="fa-solid fa-route mr-2"></i> Routing Rules
                    </button>
                    <button id="tab-logs" class="tab-button" onclick="switchTab('logs')">
                        <i class="fa-solid fa-list-check mr-2"></i> Delivery Logs
                    </button>
                </div>
            </div>
        </div>

        <main class="flex-1 overflow-y-auto p-6 scroll-smooth bg-slate-50/50">
            
            <div class="max-w-7xl mx-auto space-y-6">
                
                <!-- Page Title Area -->
                <div class="flex justify-between items-end mb-2">
                    <div>
                        <h1 class="text-2xl font-bold text-slate-900">Notification & Multi-Channel Alerts</h1>
                        <p class="text-slate-500 text-sm mt-1">Configure multi-channel alert delivery with MQTT, Email, SMS, Webhooks, and escalation policies.</p>
                    </div>
                    <div class="flex gap-2">
                        <span class="inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-xs font-medium bg-green-100 text-green-700 border border-green-200">
                            <i class="fa-solid fa-circle text-[8px]"></i> Engine Active
                        </span>
                        <span id="channels-online" class="inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-700 border border-blue-200">
                            <i class="fa-solid fa-tower-broadcast text-xs"></i> 5 Channels Online
                        </span>
                    </div>
                </div>

                <!-- TAB 1: CHANNEL CONFIGURATION -->
                <div id="tab-content-channels" class="space-y-6">
                    
                    <!-- Channel Selection Buttons -->
                    <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-3">
                        <button class="p-4 bg-white border border-slate-200 rounded-lg hover:border-brand-500 hover:bg-brand-50 transition-all flex flex-col items-center justify-center gap-2" onclick="showChannelConfig('mqtt')">
                            <i class="fa-solid fa-satellite-dish text-2xl text-brand-500"></i>
                            <span class="text-sm font-medium text-slate-700">MQTT</span>
                        </button>
                        <button class="p-4 bg-white border border-slate-200 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition-all flex flex-col items-center justify-center gap-2" onclick="showChannelConfig('email')">
                            <i class="fa-solid fa-envelope text-2xl text-blue-500"></i>
                            <span class="text-sm font-medium text-slate-700">Email</span>
                        </button>
                        <button class="p-4 bg-white border border-slate-200 rounded-lg hover:border-green-500 hover:bg-green-50 transition-all flex flex-col items-center justify-center gap-2" onclick="showChannelConfig('sms')">
                            <i class="fa-solid fa-comment-sms text-2xl text-green-500"></i>
                            <span class="text-sm font-medium text-slate-700">SMS</span>
                        </button>
                        <button class="p-4 bg-white border border-slate-200 rounded-lg hover:border-purple-500 hover:bg-purple-50 transition-all flex flex-col items-center justify-center gap-2" onclick="showChannelConfig('webhook')">
                            <i class="fa-solid fa-code-branch text-2xl text-purple-500"></i>
                            <span class="text-sm font-medium text-slate-700">Webhook</span>
                        </button>
                        <button class="p-4 bg-white border border-slate-200 rounded-lg hover:border-orange-500 hover:bg-orange-50 transition-all flex flex-col items-center justify-center gap-2" onclick="showChannelConfig('push')">
                            <i class="fa-solid fa-bell text-2xl text-orange-500"></i>
                            <span class="text-sm font-medium text-slate-700">Push</span>
                        </button>
                        <button class="p-4 bg-white border border-slate-200 rounded-lg hover:border-pink-500 hover:bg-pink-50 transition-all flex flex-col items-center justify-center gap-2" onclick="showChannelConfig('third-party')">
                            <i class="fa-solid fa-plug text-2xl text-pink-500"></i>
                            <span class="text-sm font-medium text-slate-700">Third-Party</span>
                        </button>
                    </div>

                    <!-- Active Channels Table -->
                    <section class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
                        <div class="px-6 py-4 border-b border-slate-100 flex justify-between items-center bg-slate-50/50">
                            <h2 class="font-semibold text-slate-800 flex items-center gap-2">
                                <i class="fa-solid fa-share-nodes text-brand-500"></i> Active Channels
                            </h2>
                            <button class="px-3 py-1.5 text-sm bg-white border border-slate-300 text-slate-700 font-medium rounded-lg hover:bg-slate-50 hover:text-brand-600 transition-all shadow-sm" onclick="showAddChannelModal()">
                                <i class="fa-solid fa-plus mr-1"></i> Add Channel
                            </button>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="w-full text-sm text-left">
                                <thead class="text-xs text-slate-500 uppercase bg-slate-50 border-b border-slate-100">
                                    <tr>
                                        <th class="px-6 py-3 font-medium">Channel Name</th>
                                        <th class="px-6 py-3 font-medium">Type</th>
                                        <th class="px-6 py-3 font-medium">Status</th>
                                        <th class="px-6 py-3 font-medium">Delivery Mode</th>
                                        <th class="px-6 py-3 font-medium">Throughput</th>
                                        <th class="px-6 py-3 font-medium text-right">Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="channels-list" class="divide-y divide-slate-100">
                                    <!-- Channels will be loaded dynamically -->
                                </tbody>
                            </table>
                        </div>
                    </section>

                    <!-- Channel Configuration Sections (Hidden by default, shown via JS) -->
                    <div id="channel-config-sections" class="space-y-6">
                        <!-- Each channel config will be loaded here -->
                    </div>
                </div>

                <!-- TAB 2: TEMPLATES -->
                <div id="tab-content-templates" class="space-y-6 hidden">
                    
                    <!-- Template Variables Panel -->
                    <section class="bg-white rounded-xl shadow-sm border border-slate-200">
                        <div class="px-6 py-4 border-b border-slate-100 bg-slate-50/50">
                            <h2 class="font-semibold text-slate-800 flex items-center gap-2">
                                <i class="fa-solid fa-code text-brand-500"></i> Template Variables
                            </h2>
                        </div>
                        <div class="p-6">
                            <p class="text-sm text-slate-600 mb-4">Use these variables in your templates. They will be replaced with actual values during alert generation.</p>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                <div class="border border-slate-200 rounded-lg p-4">
                                    <h3 class="text-sm font-medium text-slate-700 mb-2">Alert Information</h3>
                                    <div class="space-y-1">
                                        <div class="flex justify-between items-center">
                                            <code class="text-xs bg-slate-100 px-2 py-1 rounded">{{alert_name}}</code>
                                            <span class="text-xs text-slate-500">Alert name</span>
                                        </div>
                                        <div class="flex justify-between items-center">
                                            <code class="text-xs bg-slate-100 px-2 py-1 rounded">{{alert_class}}</code>
                                            <span class="text-xs text-slate-500">Alert class</span>
                                        </div>
                                        <div class="flex justify-between items-center">
                                            <code class="text-xs bg-slate-100 px-2 py-1 rounded">{{severity}}</code>
                                            <span class="text-xs text-slate-500">Severity level</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="border border-slate-200 rounded-lg p-4">
                                    <h3 class="text-sm font-medium text-slate-700 mb-2">Data Values</h3>
                                    <div class="space-y-1">
                                        <div class="flex justify-between items-center">
                                            <code class="text-xs bg-slate-100 px-2 py-1 rounded">{{value}}</code>
                                            <span class="text-xs text-slate-500">Current value</span>
                                        </div>
                                        <div class="flex justify-between items-center">
                                            <code class="text-xs bg-slate-100 px-2 py-1 rounded">{{unit}}</code>
                                            <span class="text-xs text-slate-500">Measurement unit</span>
                                        </div>
                                        <div class="flex justify-between items-center">
                                            <code class="text-xs bg-slate-100 px-2 py-1 rounded">{{source}}</code>
                                            <span class="text-xs text-slate-500">Source device</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="border border-slate-200 rounded-lg p-4">
                                    <h3 class="text-sm font-medium text-slate-700 mb-2">Time & Context</h3>
                                    <div class="space-y-1">
                                        <div class="flex justify-between items-center">
                                            <code class="text-xs bg-slate-100 px-2 py-1 rounded">{{timestamp}}</code>
                                            <span class="text-xs text-slate-500">Timestamp</span>
                                        </div>
                                        <div class="flex justify-between items-center">
                                            <code class="text-xs bg-slate-100 px-2 py-1 rounded">{{gateway_id}}</code>
                                            <span class="text-xs text-slate-500">Gateway ID</span>
                                        </div>
                                        <div class="flex justify-between items-center">
                                            <code class="text-xs bg-slate-100 px-2 py-1 rounded">{{location}}</code>
                                            <span class="text-xs text-slate-500">Location</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- Template Editor -->
                    <section class="bg-white rounded-xl shadow-sm border border-slate-200">
                        <div class="px-6 py-4 border-b border-slate-100 flex justify-between items-center">
                            <h2 class="font-semibold text-slate-800 flex items-center gap-2">
                                <i class="fa-solid fa-file-lines text-slate-400"></i> Message Templates
                            </h2>
                            <button class="text-xs font-medium text-brand-600 hover:underline" onclick="showAllTemplates()">View All</button>
                        </div>
                        <div class="p-6 flex flex-col md:flex-row gap-6 h-full">
                            <!-- Template List -->
                            <div class="w-full md:w-1/3 border-r border-slate-100 pr-0 md:pr-6 space-y-3">
                                <div id="templates-list" class="space-y-3">
                                    <!-- Templates will be loaded dynamically -->
                                </div>
                                <button class="w-full py-2 border border-dashed border-slate-300 rounded-lg text-xs font-medium text-slate-500 hover:text-brand-600 hover:border-brand-300 hover:bg-brand-50 transition-all" onclick="showCreateTemplateModal()">
                                    + Create New Template
                                </button>
                            </div>

                            <!-- Template Editor Preview -->
                            <div class="w-full md:w-2/3 flex flex-col gap-4">
                                <div id="template-editor" class="space-y-3">
                                    <!-- Template editor will be loaded dynamically -->
                                </div>
                                <div class="mt-auto flex justify-end gap-2">
                                    <button class="px-3 py-1.5 text-xs font-medium text-slate-600 hover:bg-slate-100 rounded-md" onclick="previewTemplate()">Preview</button>
                                    <button class="px-3 py-1.5 text-xs font-medium text-white bg-brand-600 hover:bg-brand-700 rounded-md" onclick="saveTemplate()">Save Changes</button>
                                </div>
                            </div>
                        </div>
                    </section>
                </div>

                <!-- TAB 3: ROUTING RULES -->
                <div id="tab-content-routing" class="space-y-6 hidden">
                    
                    <!-- Routing Rules Table -->
                    <section class="bg-white rounded-xl shadow-sm border border-slate-200">
                        <div class="px-6 py-4 border-b border-slate-100 flex justify-between items-center bg-slate-50/50">
                            <h2 class="font-semibold text-slate-800 flex items-center gap-2">
                                <i class="fa-solid fa-route text-slate-400"></i> Routing Rules
                            </h2>
                            <button class="px-3 py-1.5 text-sm bg-brand-600 text-white font-medium rounded-lg hover:bg-brand-700 transition-all shadow-sm" onclick="showAddRoutingRuleModal()">
                                <i class="fa-solid fa-plus mr-1"></i> Add Routing Rule
                            </button>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="w-full text-sm text-left">
                                <thead class="text-xs text-slate-500 uppercase bg-slate-50 border-b border-slate-100">
                                    <tr>
                                        <th class="px-6 py-3 font-medium">Alert Class</th>
                                        <th class="px-6 py-3 font-medium">Channels</th>
                                        <th class="px-6 py-3 font-medium">Condition</th>
                                        <th class="px-6 py-3 font-medium">Throttling</th>
                                        <th class="px-6 py-3 font-medium">Escalation</th>
                                        <th class="px-6 py-3 font-medium text-right">Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="routing-rules-list" class="divide-y divide-slate-100">
                                    <!-- Routing rules will be loaded dynamically -->
                                </tbody>
                            </table>
                        </div>
                    </section>

                    <!-- Escalation Configuration -->
                    <section class="bg-white rounded-xl shadow-sm border border-slate-200">
                        <div class="px-6 py-4 border-b border-slate-100 bg-slate-50/50">
                            <h2 class="font-semibold text-slate-800 flex items-center gap-2">
                                <i class="fa-solid fa-arrow-up-wide-short text-orange-500"></i> Escalation Policies
                            </h2>
                        </div>
                        <div class="p-6">
                            <div class="space-y-4">
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <div class="border border-slate-200 rounded-lg p-4">
                                        <h3 class="text-sm font-medium text-slate-700 mb-2">Level 1 - Immediate</h3>
                                        <p class="text-xs text-slate-500 mb-3">Initial notification to primary contacts</p>
                                        <div class="space-y-1 text-xs">
                                            <div class="flex items-center gap-2">
                                                <i class="fa-solid fa-clock text-slate-400"></i>
                                                <span>Time: Immediately</span>
                                            </div>
                                            <div class="flex items-center gap-2">
                                                <i class="fa-solid fa-users text-slate-400"></i>
                                                <span>Contacts: Primary Team</span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="border border-slate-200 rounded-lg p-4">
                                        <h3 class="text-sm font-medium text-slate-700 mb-2">Level 2 - Escalated</h3>
                                        <p class="text-xs text-slate-500 mb-3">If not acknowledged in 5 minutes</p>
                                        <div class="space-y-1 text-xs">
                                            <div class="flex items-center gap-2">
                                                <i class="fa-solid fa-clock text-slate-400"></i>
                                                <span>Time: After 5 minutes</span>
                                            </div>
                                            <div class="flex items-center gap-2">
                                                <i class="fa-solid fa-user-tie text-slate-400"></i>
                                                <span>Contacts: Supervisors</span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="border border-slate-200 rounded-lg p-4">
                                        <h3 class="text-sm font-medium text-slate-700 mb-2">Level 3 - Critical</h3>
                                        <p class="text-xs text-slate-500 mb-3">If still not resolved in 15 minutes</p>
                                        <div class="space-y-1 text-xs">
                                            <div class="flex items-center gap-2">
                                                <i class="fa-solid fa-clock text-slate-400"></i>
                                                <span>Time: After 15 minutes</span>
                                            </div>
                                            <div class="flex items-center gap-2">
                                                <i class="fa-solid fa-triangle-exclamation text-slate-400"></i>
                                                <span>Contacts: Management</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="flex justify-end">
                                    <button class="px-3 py-1.5 text-xs font-medium text-brand-600 hover:text-brand-700 hover:bg-brand-50 rounded-md border border-brand-200 transition-all" onclick="editEscalationPolicies()">
                                        Edit Escalation Policies
                                    </button>
                                </div>
                            </div>
                        </div>
                    </section>
                </div>

                <!-- TAB 4: DELIVERY LOGS -->
                <div id="tab-content-logs" class="space-y-6 hidden">
                    
                    <!-- Log Filters -->
                    <section class="bg-white rounded-xl shadow-sm border border-slate-200">
                        <div class="px-6 py-4 border-b border-slate-100 bg-slate-50/50">
                            <h2 class="font-semibold text-slate-800 flex items-center gap-2">
                                <i class="fa-solid fa-list-check text-brand-500"></i> Notification Delivery Logs
                            </h2>
                        </div>
                        <div class="p-6">
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                                <div>
                                    <label class="block text-xs font-medium text-slate-500 mb-1">Channel</label>
                                    <select id="log-channel-filter" class="w-full border border-slate-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none bg-white" onchange="filterLogs()">
                                        <option value="">All Channels</option>
                                        <option value="mqtt">MQTT</option>
                                        <option value="email">Email</option>
                                        <option value="sms">SMS</option>
                                        <option value="webhook">Webhook</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-xs font-medium text-slate-500 mb-1">Alert Class</label>
                                    <select id="log-class-filter" class="w-full border border-slate-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none bg-white" onchange="filterLogs()">
                                        <option value="">All Classes</option>
                                        <option value="critical">Critical</option>
                                        <option value="warning">Warning</option>
                                        <option value="info">Info</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-xs font-medium text-slate-500 mb-1">Status</label>
                                    <select id="log-status-filter" class="w-full border border-slate-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none bg-white" onchange="filterLogs()">
                                        <option value="">All Status</option>
                                        <option value="sent">Sent</option>
                                        <option value="delivered">Delivered</option>
                                        <option value="failed">Failed</option>
                                        <option value="pending">Pending</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-xs font-medium text-slate-500 mb-1">Date Range</label>
                                    <input type="date" id="log-date-filter" class="w-full border border-slate-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none" onchange="filterLogs()">
                                </div>
                            </div>
                            
                            <!-- Logs Table -->
                            <div class="overflow-x-auto border border-slate-200 rounded-lg">
                                <table class="w-full text-sm text-left">
                                    <thead class="text-xs text-slate-500 uppercase bg-slate-50">
                                        <tr>
                                            <th class="px-6 py-3 font-medium">Time</th>
                                            <th class="px-6 py-3 font-medium">Channel</th>
                                            <th class="px-6 py-3 font-medium">Alert Name</th>
                                            <th class="px-6 py-3 font-medium">Class</th>
                                            <th class="px-6 py-3 font-medium">Status</th>
                                            <th class="px-6 py-3 font-medium">Details</th>
                                        </tr>
                                    </thead>
                                    <tbody id="notification-logs" class="divide-y divide-slate-100">
                                        <!-- Logs will be loaded dynamically -->
                                    </tbody>
                                </table>
                            </div>
                            
                            <div class="mt-4 flex justify-between items-center">
                                <div class="text-sm text-slate-500">
                                    Showing <span id="log-count">10</span> of <span id="log-total">124</span> records
                                </div>
                                <div class="flex gap-2">
                                    <button class="px-3 py-1.5 text-xs font-medium text-slate-600 hover:bg-slate-100 rounded-md border border-slate-300" onclick="exportLogs()">
                                        <i class="fa-solid fa-download mr-1"></i> Export Logs
                                    </button>
                                    <button class="px-3 py-1.5 text-xs font-medium text-white bg-brand-600 hover:bg-brand-700 rounded-md" onclick="refreshLogs()">
                                        <i class="fa-solid fa-sync-alt mr-1"></i> Refresh
                                    </button>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- Statistics -->
                    <section class="bg-white rounded-xl shadow-sm border border-slate-200">
                        <div class="px-6 py-4 border-b border-slate-100 bg-slate-50/50">
                            <h2 class="font-semibold text-slate-800 flex items-center gap-2">
                                <i class="fa-solid fa-chart-line text-slate-400"></i> Delivery Statistics (Last 24h)
                            </h2>
                        </div>
                        <div class="p-6">
                            <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                                <div class="bg-slate-50 p-4 rounded-lg border border-slate-200">
                                    <div class="flex items-center justify-between mb-2">
                                        <span class="text-xs font-medium text-slate-500">Total Sent</span>
                                        <i class="fa-solid fa-paper-plane text-slate-400"></i>
                                    </div>
                                    <div class="text-2xl font-bold text-slate-900" id="total-sent">1,248</div>
                                    <div class="text-xs text-green-600 flex items-center gap-1">
                                        <i class="fa-solid fa-arrow-up"></i> 12% from yesterday
                                    </div>
                                </div>
                                <div class="bg-slate-50 p-4 rounded-lg border border-slate-200">
                                    <div class="flex items-center justify-between mb-2">
                                        <span class="text-xs font-medium text-slate-500">Delivery Rate</span>
                                        <i class="fa-solid fa-check-circle text-green-500"></i>
                                    </div>
                                    <div class="text-2xl font-bold text-slate-900" id="delivery-rate">98.7%</div>
                                    <div class="text-xs text-green-600 flex items-center gap-1">
                                        <i class="fa-solid fa-arrow-up"></i> 0.3% improvement
                                    </div>
                                </div>
                                <div class="bg-slate-50 p-4 rounded-lg border border-slate-200">
                                    <div class="flex items-center justify-between mb-2">
                                        <span class="text-xs font-medium text-slate-500">Avg Response Time</span>
                                        <i class="fa-solid fa-clock text-orange-500"></i>
                                    </div>
                                    <div class="text-2xl font-bold text-slate-900" id="response-time">2.3s</div>
                                    <div class="text-xs text-red-600 flex items-center gap-1">
                                        <i class="fa-solid fa-arrow-up"></i> 0.4s slower
                                    </div>
                                </div>
                                <div class="bg-slate-50 p-4 rounded-lg border border-slate-200">
                                    <div class="flex items-center justify-between mb-2">
                                        <span class="text-xs font-medium text-slate-500">Failed Attempts</span>
                                        <i class="fa-solid fa-triangle-exclamation text-red-500"></i>
                                    </div>
                                    <div class="text-2xl font-bold text-slate-900" id="failed-attempts">16</div>
                                    <div class="text-xs text-red-600 flex items-center gap-1">
                                        <i class="fa-solid fa-arrow-up"></i> 4 more than usual
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>
                </div>
            </div>
        </main>
    </div>

    <script>
        // ========== GLOBAL STATE ==========
        let channels = [];
        let templates = [];
        let routingRules = [];
        let notificationLogs = [];
        let selectedTemplate = null;
        let currentChannelType = null;
        let selectedChannelType = null;
        let notificationStats = {
            totalSent: 1248,
            deliveryRate: 98.7,
            responseTime: 2.3,
            failedAttempts: 16
        };

        // ========== SIDEBAR FUNCTIONS ==========
        async function loadSidebar() {
            try {
                const response = await fetch('sidebar.html');
                if (!response.ok) throw new Error(`Failed to load sidebar: ${response.status}`);
                document.getElementById('sidebar-container').innerHTML = await response.text();
                updateActivePage();
                initializeSidebar();
            } catch (error) {
                console.error('Error loading sidebar:', error);
                createFallbackSidebar();
            }
        }

        function createFallbackSidebar() {
            const fallbackHTML = `
                <div class="sidebar" id="sidebar">
                    <div class="sidebar-logo">
                        <div class="logo-text">
                            <i class="fa-solid fa-network-wired mr-2"></i> Innospace
                        </div>
                    </div>
                    <div class="sidebar-nav">
                        <div class="nav-section">
                            <div class="section-title">Automation & Event Engine</div>
                            <a href="automation-rules.html" class="nav-item">
                                <i class="fa-solid fa-robot"></i> Automation Rules
                            </a>
                            <a href="notification-alerts.html" class="nav-item active">
                                <i class="fa-solid fa-bell"></i> Notification & Alerts
                                <span class="nav-item-count">5</span>
                            </a>
                            <a href="event-logging.html" class="nav-item">
                                <i class="fa-solid fa-clipboard-list"></i> Event Logging
                            </a>
                        </div>
                        <div class="nav-section">
                            <div class="section-title">Configuration</div>
                            <a href="general-configuration.html" class="nav-item">
                                <i class="fa-solid fa-sliders"></i> General Configuration
                            </a>
                            <a href="device-management.html" class="nav-item">
                                <i class="fa-solid fa-microchip"></i> Device Management
                            </a>
                            <a href="protocol-mapping.html" class="nav-item">
                                <i class="fa-solid fa-exchange-alt"></i> Protocol Mapping
                            </a>
                        </div>
                    </div>
                    <div class="sidebar-footer">
                        <div class="user-profile">
                            <div class="user-avatar">
                                <i class="fa-solid fa-user"></i>
                            </div>
                            <div class="user-info">
                                <h4 class="text-sm font-medium text-white">Admin User</h4>
                                <p class="text-xs text-slate-400">System Administrator</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="sidebar-toggle" id="sidebarToggle">
                    <i class="fa-solid fa-bars"></i>
                </div>
            `;
            document.getElementById('sidebar-container').innerHTML = fallbackHTML;
            initializeSidebar();
        }

        function updateActivePage() {
            const navItems = document.querySelectorAll('.nav-item');
            navItems.forEach(item => item.classList.remove('active'));
            const alertsLink = Array.from(navItems).find(item => 
                item.textContent.includes('Notification & Alerts') || 
                item.textContent.includes('Notification')
            );
            if (alertsLink) alertsLink.classList.add('active');
        }

        function initializeSidebar() {
            const sidebar = document.getElementById('sidebar');
            const sidebarToggle = document.getElementById('sidebarToggle');
            if (!sidebar || !sidebarToggle) return;
            
            sidebarToggle.addEventListener('click', function() {
                sidebar.classList.toggle('active');
                const icon = this.querySelector('i');
                icon.className = sidebar.classList.contains('active') ? 'fa-solid fa-times' : 'fa-solid fa-bars';
            });
            
            if (window.innerWidth <= 1024) {
                sidebar.classList.add('active');
                sidebarToggle.style.left = '260px';
                sidebarToggle.querySelector('i').className = 'fa-solid fa-times';
            }
            
            window.addEventListener('resize', handleResponsive);
        }

        function handleResponsive() {
            const sidebar = document.getElementById('sidebar');
            const sidebarToggle = document.getElementById('sidebarToggle');
            
            if (window.innerWidth <= 1024) {
                sidebar.classList.remove('active');
                sidebarToggle.style.display = 'block';
                sidebarToggle.style.left = '0';
                sidebarToggle.querySelector('i').className = 'fa-solid fa-bars';
            } else {
                sidebar.classList.remove('collapsed');
                sidebar.classList.remove('active');
                sidebarToggle.style.display = 'none';
                sidebarToggle.style.left = '260px';
            }
        }

        function handleSidebarClickOutside(event) {
            const sidebar = document.getElementById('sidebar');
            const sidebarToggle = document.getElementById('sidebarToggle');
            const isMobile = window.innerWidth <= 1024;
            
            if (isMobile && sidebar.classList.contains('active')) {
                const isClickInsideSidebar = sidebar.contains(event.target);
                const isClickOnToggle = sidebarToggle.contains(event.target);
                
                if (!isClickInsideSidebar && !isClickOnToggle) {
                    sidebar.classList.remove('active');
                    sidebarToggle.querySelector('i').className = 'fa-solid fa-bars';
                    sidebarToggle.style.left = '0';
                }
            }
        }

        // ========== TAB NAVIGATION ==========
        function switchTab(tabName) {
            // Update tab buttons
            ['channels', 'templates', 'routing', 'logs'].forEach(tab => {
                const tabBtn = document.getElementById(`tab-${tab}`);
                const tabContent = document.getElementById(`tab-content-${tab}`);
                
                if (tabBtn && tabContent) {
                    if (tab === tabName) {
                        tabBtn.classList.add('active');
                        tabContent.classList.remove('hidden');
                    } else {
                        tabBtn.classList.remove('active');
                        tabContent.classList.add('hidden');
                    }
                }
            });
            
            // Load data for the tab
            switch(tabName) {
                case 'channels':
                    loadChannels();
                    break;
                case 'templates':
                    loadTemplates();
                    break;
                case 'routing':
                    loadRoutingRules();
                    break;
                case 'logs':
                    loadNotificationLogs();
                    break;
            }
        }

        // ========== MODAL FUNCTIONS ==========
        function showModal(title, content, buttons = [], width = '600px') {
            const modalOverlay = document.getElementById('modal-overlay');
            const modalContent = document.getElementById('modal-content');
            
            modalContent.style.maxWidth = width;
            modalContent.innerHTML = `
                <div class="modal-header">
                    <h3 class="text-lg font-semibold text-slate-800">${title}</h3>
                    <button class="text-slate-400 hover:text-slate-600" onclick="closeModal()">
                        <i class="fa-solid fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    ${content}
                </div>
                ${buttons.length > 0 ? `
                <div class="modal-footer">
                    ${buttons.map(btn => `
                        <button 
                            onclick="${btn.onclick}"
                            class="${btn.className}"
                            ${btn.disabled ? 'disabled' : ''}
                        >
                            ${btn.text}
                        </button>
                    `).join('')}
                </div>` : ''}
            `;
            
            modalOverlay.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeModal() {
            document.getElementById('modal-overlay').classList.remove('active');
            document.body.style.overflow = 'auto';
        }

        function showConfirmation(title, message, onConfirm, onCancel = null) {
            const overlay = document.getElementById('confirmation-overlay');
            const dialog = document.getElementById('confirmation-dialog');
            
            dialog.innerHTML = `
                <div class="mb-4">
                    <i class="fa-solid fa-triangle-exclamation text-3xl text-yellow-500 mb-3"></i>
                    <h3 class="text-lg font-semibold text-slate-800 mb-2">${title}</h3>
                    <p class="text-slate-600">${message}</p>
                </div>
                <div class="flex justify-center gap-3">
                    <button onclick="closeConfirmation()" class="px-4 py-2 text-sm font-medium text-slate-700 hover:bg-slate-100 rounded-lg border border-slate-300 transition-colors">
                        Cancel
                    </button>
                    <button onclick="confirmAction()" class="px-4 py-2 text-sm font-medium text-white bg-brand-600 hover:bg-brand-700 rounded-lg shadow-sm transition-colors">
                        Confirm
                    </button>
                </div>
            `;
            
            window.confirmAction = function() {
                if (onConfirm) onConfirm();
                closeConfirmation();
            };
            
            overlay.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeConfirmation() {
            document.getElementById('confirmation-overlay').classList.remove('active');
            document.body.style.overflow = 'auto';
        }

        // ========== TOAST FUNCTIONS ==========
        function showToast(message, type = 'success', duration = 5000) {
            const container = document.getElementById('toast-container');
            const toastId = 'toast-' + Date.now();
            const icon = {
                success: 'fa-circle-check',
                error: 'fa-circle-exclamation',
                warning: 'fa-triangle-exclamation',
                info: 'fa-circle-info'
            }[type];
            
            const toast = document.createElement('div');
            toast.id = toastId;
            toast.className = `toast toast-${type}`;
            toast.innerHTML = `
                <i class="fa-solid ${icon} text-${type === 'success' ? 'green' : type === 'error' ? 'red' : type === 'warning' ? 'yellow' : 'blue'}-500 text-lg"></i>
                <div class="flex-1">
                    <p class="text-sm font-medium text-slate-800">${message}</p>
                </div>
                <button onclick="closeToast('${toastId}')" class="text-slate-400 hover:text-slate-600">
                    <i class="fa-solid fa-times"></i>
                </button>
            `;
            
            container.appendChild(toast);
            
            setTimeout(() => {
                toast.classList.add('show');
            }, 10);
            
            if (duration > 0) {
                setTimeout(() => {
                    closeToast(toastId);
                }, duration);
            }
        }

        function closeToast(toastId) {
            const toast = document.getElementById(toastId);
            if (toast) {
                toast.classList.remove('show');
                setTimeout(() => {
                    toast.remove();
                }, 300);
            }
        }

        // ========== CHANNEL MANAGEMENT ==========
        function loadChannels() {
            channels = [
                {
                    id: 'mqtt-primary',
                    name: 'MQTT_Alert_Broker',
                    type: 'MQTT',
                    status: 'active',
                    deliveryMode: 'Critical Alerts',
                    throughput: 60,
                    successRate: 99.5,
                    icon: 'fa-satellite-dish',
                    color: 'brand'
                },
                {
                    id: 'email-primary',
                    name: 'Corp_SMTP_Relay',
                    type: 'Email SMTP',
                    status: 'active',
                    deliveryMode: 'All Alerts',
                    throughput: 85,
                    successRate: 99.9,
                    icon: 'fa-envelope',
                    color: 'blue'
                },
                {
                    id: 'sms-primary',
                    name: 'SMS_Gateway_Pri',
                    type: 'SMS (Twilio)',
                    status: 'active',
                    deliveryMode: 'Critical & OTP',
                    throughput: 45,
                    successRate: 98,
                    icon: 'fa-comment-sms',
                    color: 'green'
                },
                {
                    id: 'webhook-qc',
                    name: 'QC_Sys_Webhook',
                    type: 'Webhook (POST)',
                    status: 'inactive',
                    deliveryMode: 'Maintenance',
                    throughput: 0,
                    successRate: 0,
                    icon: 'fa-code-branch',
                    color: 'purple'
                }
            ];
            
            renderChannelsList();
            updateChannelsOnline();
        }

        function renderChannelsList() {
            const container = document.getElementById('channels-list');
            if (!container) return;
            
            container.innerHTML = channels.map(channel => `
                <tr class="hover:bg-slate-50/50 transition-colors group">
                    <td class="px-6 py-4 font-medium text-slate-900 flex items-center gap-3">
                        <div class="w-8 h-8 rounded-lg bg-${channel.color}-100 text-${channel.color}-600 flex items-center justify-center">
                            <i class="fa-solid ${channel.icon}"></i>
                        </div>
                        ${channel.name}
                    </td>
                    <td class="px-6 py-4 text-slate-600">${channel.type}</td>
                    <td class="px-6 py-4">
                        <span class="inline-flex items-center gap-1.5 px-2.5 py-0.5 rounded-full text-xs font-medium 
                            ${channel.status === 'active' ? 'bg-green-50 text-green-700 border border-green-100' : 
                              channel.status === 'degraded' ? 'bg-yellow-50 text-yellow-700 border border-yellow-100' : 
                              'bg-slate-100 text-slate-600 border border-slate-200'}">
                            ${channel.status === 'active' ? 'Active' : 
                             channel.status === 'degraded' ? 'Degraded' : 'Inactive'}
                        </span>
                    </td>
                    <td class="px-6 py-4 text-slate-600">${channel.deliveryMode}</td>
                    <td class="px-6 py-4 text-slate-500 text-xs">
                        <div class="w-24 bg-slate-200 rounded-full h-1.5 mb-1">
                            <div class="bg-${channel.color}-500 h-1.5 rounded-full" style="width: ${channel.throughput}%"></div>
                        </div>
                        ${channel.successRate > 0 ? channel.successRate + '% Success' : 'No activity'}
                    </td>
                    <td class="px-6 py-4 text-right">
                        <button class="text-slate-400 hover:text-brand-600 px-2" onclick="editChannel('${channel.id}')">
                            <i class="fa-solid fa-pen"></i>
                        </button>
                        <button class="text-slate-400 hover:text-${channel.status === 'active' ? 'red' : 'green'}-500 px-2" onclick="toggleChannelStatus('${channel.id}')">
                            <i class="fa-solid fa-${channel.status === 'active' ? 'power-off' : 'play'}"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        function updateChannelsOnline() {
            const onlineCount = channels.filter(c => c.status === 'active').length;
            document.getElementById('channels-online').innerHTML = `
                <i class="fa-solid fa-tower-broadcast text-xs"></i> ${onlineCount} Channels Online
            `;
        }

        function showAddChannelModal() {
            showModal(
                'Add New Channel',
                `
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">Channel Type</label>
                        <div class="grid grid-cols-2 md:grid-cols-3 gap-3">
                            <button class="p-4 bg-slate-50 border border-slate-200 rounded-lg hover:border-brand-500 hover:bg-brand-50 transition-all flex flex-col items-center justify-center gap-2" onclick="selectChannelType('mqtt')">
                                <i class="fa-solid fa-satellite-dish text-2xl text-brand-500"></i>
                                <span class="text-sm font-medium text-slate-700">MQTT</span>
                            </button>
                            <button class="p-4 bg-slate-50 border border-slate-200 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition-all flex flex-col items-center justify-center gap-2" onclick="selectChannelType('email')">
                                <i class="fa-solid fa-envelope text-2xl text-blue-500"></i>
                                <span class="text-sm font-medium text-slate-700">Email</span>
                            </button>
                            <button class="p-4 bg-slate-50 border border-slate-200 rounded-lg hover:border-green-500 hover:bg-green-50 transition-all flex flex-col items-center justify-center gap-2" onclick="selectChannelType('sms')">
                                <i class="fa-solid fa-comment-sms text-2xl text-green-500"></i>
                                <span class="text-sm font-medium text-slate-700">SMS</span>
                            </button>
                            <button class="p-4 bg-slate-50 border border-slate-200 rounded-lg hover:border-purple-500 hover:bg-purple-50 transition-all flex flex-col items-center justify-center gap-2" onclick="selectChannelType('webhook')">
                                <i class="fa-solid fa-code-branch text-2xl text-purple-500"></i>
                                <span class="text-sm font-medium text-slate-700">Webhook</span>
                            </button>
                            <button class="p-4 bg-slate-50 border border-slate-200 rounded-lg hover:border-orange-500 hover:bg-orange-50 transition-all flex flex-col items-center justify-center gap-2" onclick="selectChannelType('push')">
                                <i class="fa-solid fa-bell text-2xl text-orange-500"></i>
                                <span class="text-sm font-medium text-slate-700">Push</span>
                            </button>
                            <button class="p-4 bg-slate-50 border border-slate-200 rounded-lg hover:border-pink-500 hover:bg-pink-50 transition-all flex flex-col items-center justify-center gap-2" onclick="selectChannelType('third-party')">
                                <i class="fa-solid fa-plug text-2xl text-pink-500"></i>
                                <span class="text-sm font-medium text-slate-700">Third-Party</span>
                            </button>
                        </div>
                    </div>
                    
                    <div id="channel-details-form" class="hidden space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-1">Channel Name</label>
                            <input type="text" id="channel-name" class="w-full border border-slate-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none" placeholder="e.g., Primary_Email_Channel">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-1">Description</label>
                            <textarea id="channel-description" class="w-full h-20 border border-slate-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none resize-none" placeholder="Brief description of this channel"></textarea>
                        </div>
                    </div>
                </div>
                `,
                [
                    {
                        text: 'Cancel',
                        className: 'px-4 py-2 text-sm font-medium text-slate-700 hover:bg-slate-100 rounded-lg border border-slate-300 transition-colors',
                        onclick: 'closeModal()'
                    },
                    {
                        text: 'Add Channel',
                        className: 'px-4 py-2 text-sm font-medium text-white bg-brand-600 hover:bg-brand-700 rounded-lg shadow-sm transition-colors',
                        onclick: 'addNewChannel()',
                        disabled: true
                    }
                ]
            );
        }

        function selectChannelType(type) {
            selectedChannelType = type;
            const form = document.getElementById('channel-details-form');
            const addButton = document.querySelector('.modal-footer button:last-child');
            
            if (form) {
                form.classList.remove('hidden');
                
                // Update channel name placeholder based on type
                const nameInput = document.getElementById('channel-name');
                const typeNames = {
                    mqtt: 'MQTT_Broker',
                    email: 'Email_SMTP',
                    sms: 'SMS_Gateway',
                    webhook: 'Webhook_Endpoint',
                    push: 'Push_Notifications',
                    'third-party': 'Third_Party_Integration'
                };
                nameInput.placeholder = `${typeNames[type]}_${Math.floor(Math.random() * 100)}`;
                
                // Enable add button
                if (addButton) {
                    addButton.disabled = false;
                    addButton.onclick = () => addNewChannel();
                }
            }
        }

        function addNewChannel() {
            if (!selectedChannelType) return;
            
            const nameInput = document.getElementById('channel-name');
            const descriptionInput = document.getElementById('channel-description');
            
            if (!nameInput.value.trim()) {
                showToast('Please enter a channel name', 'error');
                return;
            }
            
            const newChannel = {
                id: `${selectedChannelType}-${Date.now()}`,
                name: nameInput.value,
                type: selectedChannelType.toUpperCase(),
                status: 'active',
                deliveryMode: 'All Alerts',
                throughput: 0,
                successRate: 0,
                icon: getChannelIcon(selectedChannelType),
                color: getChannelColor(selectedChannelType)
            };
            
            channels.push(newChannel);
            renderChannelsList();
            updateChannelsOnline();
            closeModal();
            showToast(`Added new ${selectedChannelType.toUpperCase()} channel: ${nameInput.value}`, 'success');
        }

        function getChannelIcon(type) {
            const icons = {
                mqtt: 'fa-satellite-dish',
                email: 'fa-envelope',
                sms: 'fa-comment-sms',
                webhook: 'fa-code-branch',
                push: 'fa-bell',
                'third-party': 'fa-plug'
            };
            return icons[type] || 'fa-plug';
        }

        function getChannelColor(type) {
            const colors = {
                mqtt: 'brand',
                email: 'blue',
                sms: 'green',
                webhook: 'purple',
                push: 'orange',
                'third-party': 'pink'
            };
            return colors[type] || 'slate';
        }

        function editChannel(channelId) {
            const channel = channels.find(c => c.id === channelId);
            if (!channel) return;
            
            showModal(
                `Edit ${channel.type} Channel`,
                `
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-1">Channel Name</label>
                        <input type="text" id="edit-channel-name" class="w-full border border-slate-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none" value="${channel.name}">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-1">Status</label>
                        <select id="edit-channel-status" class="w-full border border-slate-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none bg-white">
                            <option value="active" ${channel.status === 'active' ? 'selected' : ''}>Active</option>
                            <option value="inactive" ${channel.status === 'inactive' ? 'selected' : ''}>Inactive</option>
                            <option value="degraded" ${channel.status === 'degraded' ? 'selected' : ''}>Degraded</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-1">Delivery Mode</label>
                        <select id="edit-channel-mode" class="w-full border border-slate-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none bg-white">
                            <option ${channel.deliveryMode === 'All Alerts' ? 'selected' : ''}>All Alerts</option>
                            <option ${channel.deliveryMode === 'Critical Alerts' ? 'selected' : ''}>Critical Alerts Only</option>
                            <option ${channel.deliveryMode === 'Maintenance' ? 'selected' : ''}>Maintenance Mode</option>
                        </select>
                    </div>
                </div>
                `,
                [
                    {
                        text: 'Cancel',
                        className: 'px-4 py-2 text-sm font-medium text-slate-700 hover:bg-slate-100 rounded-lg border border-slate-300 transition-colors',
                        onclick: 'closeModal()'
                    },
                    {
                        text: 'Save Changes',
                        className: 'px-4 py-2 text-sm font-medium text-white bg-brand-600 hover:bg-brand-700 rounded-lg shadow-sm transition-colors',
                        onclick: `saveChannelEdit('${channelId}')`
                    }
                ]
            );
        }

        function saveChannelEdit(channelId) {
            const channel = channels.find(c => c.id === channelId);
            if (!channel) return;
            
            const nameInput = document.getElementById('edit-channel-name');
            const statusInput = document.getElementById('edit-channel-status');
            const modeInput = document.getElementById('edit-channel-mode');
            
            if (nameInput) channel.name = nameInput.value;
            if (statusInput) channel.status = statusInput.value;
            if (modeInput) channel.deliveryMode = modeInput.value;
            
            renderChannelsList();
            updateChannelsOnline();
            closeModal();
            showToast('Channel updated successfully', 'success');
        }

        function toggleChannelStatus(channelId) {
            const channel = channels.find(c => c.id === channelId);
            if (!channel) return;
            
            const action = channel.status === 'active' ? 'deactivate' : 'activate';
            
            showConfirmation(
                `${action === 'activate' ? 'Activate' : 'Deactivate'} Channel`,
                `Are you sure you want to ${action} ${channel.name}?`,
                () => {
                    channel.status = action === 'activate' ? 'active' : 'inactive';
                    channel.throughput = action === 'activate' ? 60 : 0;
                    channel.successRate = action === 'activate' ? 99.5 : 0;
                    renderChannelsList();
                    updateChannelsOnline();
                    showToast(`Channel ${action}d successfully`, 'success');
                }
            );
        }

        function showChannelConfig(channelType) {
            currentChannelType = channelType;
            const container = document.getElementById('channel-config-sections');
            
            const configs = {
                mqtt: getMQTTConfigHTML(),
                email: getEmailConfigHTML(),
                sms: getSMSConfigHTML(),
                webhook: getWebhookConfigHTML(),
                push: getPushConfigHTML(),
                'third-party': getThirdPartyConfigHTML()
            };
            
            container.innerHTML = configs[channelType] || '';
            container.scrollIntoView({ behavior: 'smooth' });
        }

        function getMQTTConfigHTML() {
            return `
                <section class="bg-white rounded-xl shadow-sm border border-slate-200">
                    <div class="px-6 py-4 border-b border-slate-100 bg-slate-50/50">
                        <h2 class="font-semibold text-slate-800 flex items-center gap-2">
                            <i class="fa-solid fa-satellite-dish text-brand-500"></i> MQTT Notification Channel
                        </h2>
                    </div>
                    <div class="p-6 space-y-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <h3 class="text-sm font-medium text-slate-700">Enabled</h3>
                                <p class="text-xs text-slate-500">Enable MQTT alert publishing</p>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-medium text-slate-700 mb-1">Broker URL</label>
                                <input type="text" value="mqtt://broker.example.com:1883" class="w-full border border-slate-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none" placeholder="mqtt://broker:port">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-slate-700 mb-1">Alert Topic</label>
                                <input type="text" value="device/alerts" class="w-full border border-slate-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none" placeholder="alert/topic">
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-medium text-slate-700 mb-1">Username</label>
                                <input type="text" class="w-full border border-slate-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none" placeholder="Optional">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-slate-700 mb-1">Password</label>
                                <input type="password" class="w-full border border-slate-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none" placeholder="Optional">
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-1">QoS Level</label>
                            <div class="flex gap-4">
                                <label class="flex items-center">
                                    <input type="radio" name="mqtt-qos" value="0" class="h-4 w-4 text-brand-600 focus:ring-brand-500 border-slate-300" checked>
                                    <span class="ml-2 text-sm text-slate-600">0 - At most once</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="radio" name="mqtt-qos" value="1" class="h-4 w-4 text-brand-600 focus:ring-brand-500 border-slate-300">
                                    <span class="ml-2 text-sm text-slate-600">1 - At least once</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="radio" name="mqtt-qos" value="2" class="h-4 w-4 text-brand-600 focus:ring-brand-500 border-slate-300">
                                    <span class="ml-2 text-sm text-slate-600">2 - Exactly once</span>
                                </label>
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-1">Payload Template</label>
                            <textarea class="w-full h-32 font-mono text-sm border border-slate-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none resize-none">{
  "alert": "{{alert_name}}",
  "severity": "{{severity}}",
  "value": "{{value}}",
  "unit": "{{unit}}",
  "timestamp": "{{timestamp}}",
  "gateway_id": "{{gateway_id}}",
  "location": "{{location}}"
}</textarea>
                            <p class="text-xs text-slate-500 mt-1">JSON payload template for MQTT messages</p>
                        </div>
                        
                        <div class="flex justify-end gap-3 pt-4 border-t border-slate-200">
                            <button class="px-4 py-2 text-sm font-medium text-slate-700 hover:bg-slate-100 rounded-lg border border-slate-300 transition-colors" onclick="testMQTT()">
                                <i class="fa-solid fa-vial mr-1"></i> Test MQTT
                            </button>
                            <button class="px-4 py-2 text-sm font-medium text-white bg-brand-600 hover:bg-brand-700 rounded-lg shadow-sm transition-colors" onclick="saveMQTTConfig()">
                                <i class="fa-solid fa-save mr-1"></i> Save MQTT Config
                            </button>
                        </div>
                    </div>
                </section>
            `;
        }

        function getEmailConfigHTML() {
            return `
                <section class="bg-white rounded-xl shadow-sm border border-slate-200">
                    <div class="px-6 py-4 border-b border-slate-100 bg-slate-50/50">
                        <h2 class="font-semibold text-slate-800 flex items-center gap-2">
                            <i class="fa-solid fa-envelope text-blue-500"></i> Email Notification Channel
                        </h2>
                    </div>
                    <div class="p-6 space-y-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <h3 class="text-sm font-medium text-slate-700">Enabled</h3>
                                <p class="text-xs text-slate-500">Enable email alert delivery</p>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-medium text-slate-700 mb-1">SMTP Server</label>
                                <input type="text" value="smtp.gmail.com" class="w-full border border-slate-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-slate-700 mb-1">Port</label>
                                <input type="number" value="587" class="w-full border border-slate-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none">
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-medium text-slate-700 mb-1">Username</label>
                                <input type="text" class="w-full border border-slate-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none" placeholder="email@example.com">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-slate-700 mb-1">Password</label>
                                <input type="password" class="w-full border border-slate-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none">
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-1">From Email</label>
                            <input type="email" value="alerts@gateway.com" class="w-full border border-slate-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-1">Recipients</label>
                            <div class="flex flex-wrap gap-2 mb-2">
                                <span class="inline-flex items-center px-3 py-1 rounded-full bg-blue-100 text-blue-700 text-sm">
                                    ops-team@example.com
                                    <button class="ml-2 text-blue-500 hover:text-blue-700" onclick="removeRecipient(this)"></button>
                                </span>
                                <span class="inline-flex items-center px-3 py-1 rounded-full bg-blue-100 text-blue-700 text-sm">
                                    supervisor@example.com
                                    <button class="ml-2 text-blue-500 hover:text-blue-700" onclick="removeRecipient(this)"></button>
                                </span>
                            </div>
                            <div class="flex gap-2">
                                <input type="email" id="new-recipient" class="flex-1 border border-slate-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none" placeholder="Add recipient email">
                                <button class="px-3 py-2 text-sm bg-brand-600 text-white rounded-lg hover:bg-brand-700" onclick="addRecipient()">Add</button>
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-1">Subject Template</label>
                            <input type="text" value="Gateway Alert: {{alert_name}} ({{severity}})" class="w-full border border-slate-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-1">Message Template</label>
                            <textarea class="w-full h-40 border border-slate-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none resize-none">Alert: {{alert_name}}
Severity: {{severity}}
Value: {{value}} {{unit}}
Time: {{timestamp}}
Source: {{source}}
Location: {{location}}

Please investigate immediately.</textarea>
                        </div>
                        
                        <div class="flex justify-end gap-3 pt-4 border-t border-slate-200">
                            <button class="px-4 py-2 text-sm font-medium text-slate-700 hover:bg-slate-100 rounded-lg border border-slate-300 transition-colors" onclick="testEmail()">
                                <i class="fa-solid fa-paper-plane mr-1"></i> Test Email
                            </button>
                            <button class="px-4 py-2 text-sm font-medium text-white bg-brand-600 hover:bg-brand-700 rounded-lg shadow-sm transition-colors" onclick="saveEmailConfig()">
                                <i class="fa-solid fa-save mr-1"></i> Save Email Config
                            </button>
                        </div>
                    </div>
                </section>
            `;
        }

        function getSMSConfigHTML() {
            return `
                <section class="bg-white rounded-xl shadow-sm border border-slate-200">
                    <div class="px-6 py-4 border-b border-slate-100 bg-slate-50/50">
                        <h2 class="font-semibold text-slate-800 flex items-center gap-2">
                            <i class="fa-solid fa-comment-sms text-green-500"></i> SMS Notification Channel
                        </h2>
                    </div>
                    <div class="p-6 space-y-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <h3 class="text-sm font-medium text-slate-700">Enabled</h3>
                                <p class="text-xs text-slate-500">Enable SMS alert delivery</p>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-1">SMS Provider</label>
                            <select class="w-full border border-slate-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none bg-white">
                                <option>Twilio</option>
                                <option>Nexmo/Vonage</option>
                                <option>MessageBird</option>
                                <option>Custom Gateway</option>
                            </select>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-medium text-slate-700 mb-1">API URL</label>
                                <input type="text" value="https://api.twilio.com/2010-04-01/Accounts/" class="w-full border border-slate-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-slate-700 mb-1">API Key</label>
                                <input type="password" class="w-full border border-slate-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none">
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-medium text-slate-700 mb-1">Sender ID</label>
                                <input type="text" value="UNIVA-GW" class="w-full border border-slate-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-slate-700 mb-1">Rate Limit (per hour)</label>
                                <input type="number" value="100" class="w-full border border-slate-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none">
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-1">Recipients</label>
                            <div class="flex flex-wrap gap-2 mb-2">
                                <span class="inline-flex items-center px-3 py-1 rounded-full bg-green-100 text-green-700 text-sm">
                                    +91 9876543210
                                    <button class="ml-2 text-green-500 hover:text-green-700" onclick="removeRecipient(this)"></button>
                                </span>
                                <span class="inline-flex items-center px-3 py-1 rounded-full bg-green-100 text-green-700 text-sm">
                                    +971 501234567
                                    <button class="ml-2 text-green-500 hover:text-green-700" onclick="removeRecipient(this)"></button>
                                </span>
                            </div>
                            <div class="flex gap-2">
                                <input type="tel" id="new-sms-recipient" class="flex-1 border border-slate-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none" placeholder="+91 9876543210">
                                <button class="px-3 py-2 text-sm bg-brand-600 text-white rounded-lg hover:bg-brand-700" onclick="addSMSRecipient()">Add</button>
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-1">Message Template (160 chars max)</label>
                            <textarea class="w-full h-24 border border-slate-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none resize-none">Alert: {{alert_name}}
Value: {{value}}{{unit}}
Time: {{timestamp}}
Location: {{location}}</textarea>
                            <div class="flex justify-between items-center mt-1">
                                <p class="text-xs text-slate-500">Use {{variable}} for dynamic content</p>
                                <span class="text-xs text-slate-500">Characters: <span id="sms-char-count">85</span>/160</span>
                            </div>
                        </div>
                        
                        <div class="flex justify-end gap-3 pt-4 border-t border-slate-200">
                            <button class="px-4 py-2 text-sm font-medium text-slate-700 hover:bg-slate-100 rounded-lg border border-slate-300 transition-colors" onclick="testSMS()">
                                <i class="fa-solid fa-message mr-1"></i> Test SMS
                            </button>
                            <button class="px-4 py-2 text-sm font-medium text-white bg-brand-600 hover:bg-brand-700 rounded-lg shadow-sm transition-colors" onclick="saveSMSConfig()">
                                <i class="fa-solid fa-save mr-1"></i> Save SMS Config
                            </button>
                        </div>
                    </div>
                </section>
            `;
        }

        function getWebhookConfigHTML() {
            return `
                <section class="bg-white rounded-xl shadow-sm border border-slate-200">
                    <div class="px-6 py-4 border-b border-slate-100 bg-slate-50/50">
                        <h2 class="font-semibold text-slate-800 flex items-center gap-2">
                            <i class="fa-solid fa-code-branch text-purple-500"></i> HTTP Webhook Notification Channel
                        </h2>
                    </div>
                    <div class="p-6 space-y-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <h3 class="text-sm font-medium text-slate-700">Enabled</h3>
                                <p class="text-xs text-slate-500">Enable webhook alert delivery</p>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-medium text-slate-700 mb-1">Webhook URL</label>
                                <input type="text" value="https://myserver.com/alert_receiver" class="w-full border border-slate-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none" placeholder="https://example.com/webhook">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-slate-700 mb-1">HTTP Method</label>
                                <select class="w-full border border-slate-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none bg-white">
                                    <option>POST</option>
                                    <option>GET</option>
                                    <option>PUT</option>
                                    <option>PATCH</option>
                                </select>
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-1">Headers</label>
                            <div class="space-y-2">
                                <div class="flex gap-2">
                                    <input type="text" value="Content-Type" class="flex-1 border border-slate-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none" placeholder="Header name">
                                    <input type="text" value="application/json" class="flex-1 border border-slate-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none" placeholder="Header value">
                                    <button class="px-3 py-2 text-sm bg-slate-100 text-slate-700 rounded-lg hover:bg-slate-200">Add</button>
                                </div>
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-1">Body Template</label>
                            <textarea class="w-full h-40 font-mono text-sm border border-slate-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none resize-none">{
  "alert": "{{alert_name}}",
  "severity": "{{severity}}",
  "data": {
    "value": "{{value}}",
    "unit": "{{unit}}",
    "timestamp": "{{timestamp}}",
    "source": "{{source}}",
    "location": "{{location}}"
  },
  "gateway_id": "{{gateway_id}}"
}</textarea>
                        </div>
                        
                        <div class="bg-slate-50 p-4 rounded-lg border border-slate-200">
                            <h4 class="text-sm font-medium text-slate-700 mb-3">Retry Configuration</h4>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div>
                                    <label class="block text-xs font-medium text-slate-500 mb-1">Max Retries</label>
                                    <input type="number" value="3" class="w-full border border-slate-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none">
                                </div>
                                <div>
                                    <label class="block text-xs font-medium text-slate-500 mb-1">Retry Interval</label>
                                    <input type="number" value="2" class="w-full border border-slate-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none">
                                    <span class="text-xs text-slate-500">seconds</span>
                                </div>
                                <div class="flex items-center">
                                    <label class="flex items-center">
                                        <input type="checkbox" checked class="h-4 w-4 text-brand-600 focus:ring-brand-500 border-slate-300 rounded">
                                        <span class="ml-2 text-sm text-slate-600">Exponential Backoff</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="flex justify-end gap-3 pt-4 border-t border-slate-200">
                            <button class="px-4 py-2 text-sm font-medium text-slate-700 hover:bg-slate-100 rounded-lg border border-slate-300 transition-colors" onclick="testWebhook()">
                                <i class="fa-solid fa-bolt mr-1"></i> Test Webhook
                            </button>
                            <button class="px-4 py-2 text-sm font-medium text-white bg-brand-600 hover:bg-brand-700 rounded-lg shadow-sm transition-colors" onclick="saveWebhookConfig()">
                                <i class="fa-solid fa-save mr-1"></i> Save Webhook Config
                            </button>
                        </div>
                    </div>
                </section>
            `;
        }

        function getPushConfigHTML() {
            return `
                <section class="bg-white rounded-xl shadow-sm border border-slate-200">
                    <div class="px-6 py-4 border-b border-slate-100 bg-slate-50/50">
                        <h2 class="font-semibold text-slate-800 flex items-center gap-2">
                            <i class="fa-solid fa-bell text-orange-500"></i> Push Notification Channel
                        </h2>
                    </div>
                    <div class="p-6 space-y-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <h3 class="text-sm font-medium text-slate-700">Enabled</h3>
                                <p class="text-xs text-slate-500">Enable push notification delivery</p>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-1">Push Service</label>
                            <select class="w-full border border-slate-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none bg-white">
                                <option>Firebase Cloud Messaging (FCM)</option>
                                <option>Apple Push Notification (APN)</option>
                                <option>Web Push API</option>
                                <option>Custom Service</option>
                            </select>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-medium text-slate-700 mb-1">Server Key / API Key</label>
                                <input type="password" class="w-full border border-slate-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-slate-700 mb-1">Project ID / App ID</label>
                                <input type="text" class="w-full border border-slate-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none">
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-1">Notification Title Template</label>
                            <input type="text" value="Gateway Alert: {{alert_name}}" class="w-full border border-slate-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-1">Notification Body Template</label>
                            <textarea class="w-full h-24 border border-slate-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none resize-none">Severity: {{severity}}
Value: {{value}}{{unit}}
Time: {{timestamp}}</textarea>
                        </div>
                        
                        <div class="bg-slate-50 p-4 rounded-lg border border-slate-200">
                            <h4 class="text-sm font-medium text-slate-700 mb-2">Notification Settings</h4>
                            <div class="space-y-2">
                                <label class="flex items-center">
                                    <input type="checkbox" checked class="h-4 w-4 text-brand-600 focus:ring-brand-500 border-slate-300 rounded">
                                    <span class="ml-2 text-sm text-slate-600">Show notification on screen</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" checked class="h-4 w-4 text-brand-600 focus:ring-brand-500 border-slate-300 rounded">
                                    <span class="ml-2 text-sm text-slate-600">Play sound for critical alerts</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" class="h-4 w-4 text-brand-600 focus:ring-brand-500 border-slate-300 rounded">
                                    <span class="ml-2 text-sm text-slate-600">Vibrate device</span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="flex justify-end gap-3 pt-4 border-t border-slate-200">
                            <button class="px-4 py-2 text-sm font-medium text-slate-700 hover:bg-slate-100 rounded-lg border border-slate-300 transition-colors" onclick="testPush()">
                                <i class="fa-solid fa-bell mr-1"></i> Test Push
                            </button>
                            <button class="px-4 py-2 text-sm font-medium text-white bg-brand-600 hover:bg-brand-700 rounded-lg shadow-sm transition-colors" onclick="savePushConfig()">
                                <i class="fa-solid fa-save mr-1"></i> Save Push Config
                            </button>
                        </div>
                    </div>
                </section>
            `;
        }

        function getThirdPartyConfigHTML() {
            return `
                <section class="bg-white rounded-xl shadow-sm border border-slate-200">
                    <div class="px-6 py-4 border-b border-slate-100 bg-slate-50/50">
                        <h2 class="font-semibold text-slate-800 flex items-center gap-2">
                            <i class="fa-solid fa-plug text-pink-500"></i> Third-Party Integration
                        </h2>
                    </div>
                    <div class="p-6 space-y-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <h3 class="text-sm font-medium text-slate-700">Enabled</h3>
                                <p class="text-xs text-slate-500">Enable third-party integrations</p>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-3">Select Integration</label>
                            <div class="grid grid-cols-2 md:grid-cols-3 gap-3">
                                <button class="p-4 bg-slate-50 border border-slate-200 rounded-lg hover:border-slate-400 hover:bg-slate-100 transition-all flex flex-col items-center justify-center gap-2">
                                    <i class="fa-brands fa-slack text-2xl text-purple-500"></i>
                                    <span class="text-sm font-medium text-slate-700">Slack</span>
                                </button>
                                <button class="p-4 bg-slate-50 border border-slate-200 rounded-lg hover:border-slate-400 hover:bg-slate-100 transition-all flex flex-col items-center justify-center gap-2">
                                    <i class="fa-brands fa-microsoft text-2xl text-blue-500"></i>
                                    <span class="text-sm font-medium text-slate-700">Teams</span>
                                </button>
                                <button class="p-4 bg-slate-50 border border-slate-200 rounded-lg hover:border-slate-400 hover:bg-slate-100 transition-all flex flex-col items-center justify-center gap-2">
                                    <i class="fa-brands fa-whatsapp text-2xl text-green-500"></i>
                                    <span class="text-sm font-medium text-slate-700">WhatsApp</span>
                                </button>
                                <button class="p-4 bg-slate-50 border border-slate-200 rounded-lg hover:border-slate-400 hover:bg-slate-100 transition-all flex flex-col items-center justify-center gap-2">
                                    <i class="fa-brands fa-telegram text-2xl text-blue-400"></i>
                                    <span class="text-sm font-medium text-slate-700">Telegram</span>
                                </button>
                                <button class="p-4 bg-slate-50 border border-slate-200 rounded-lg hover:border-slate-400 hover:bg-slate-100 transition-all flex flex-col items-center justify-center gap-2">
                                    <i class="fa-brands fa-discord text-2xl text-indigo-500"></i>
                                    <span class="text-sm font-medium text-slate-700">Discord</span>
                                </button>
                                <button class="p-4 bg-slate-50 border border-slate-200 rounded-lg hover:border-slate-400 hover:bg-slate-100 transition-all flex flex-col items-center justify-center gap-2">
                                    <i class="fa-solid fa-plus text-2xl text-slate-400"></i>
                                    <span class="text-sm font-medium text-slate-700">Custom</span>
                                </button>
                            </div>
                        </div>
                        
                        <!-- Slack Configuration (Example) -->
                        <div id="slack-config" class="space-y-4 border border-slate-200 rounded-lg p-4">
                            <h4 class="text-sm font-medium text-slate-700 flex items-center gap-2">
                                <i class="fa-brands fa-slack text-purple-500"></i> Slack Integration
                            </h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-slate-700 mb-1">Webhook URL</label>
                                    <input type="text" class="w-full border border-slate-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none" placeholder="https://hooks.slack.com/services/...">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-slate-700 mb-1">Channel</label>
                                    <input type="text" value="#alerts" class="w-full border border-slate-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none">
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-slate-700 mb-1">Message Template</label>
                                <textarea class="w-full h-32 border border-slate-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none resize-none">*Alert*: {{alert_name}}
*Severity*: {{severity}}
*Value*: {{value}} {{unit}}
*Time*: {{timestamp}}
*Location*: {{location}}

<{{dashboard_url}}|View Dashboard></textarea>
                            </div>
                        </div>
                        
                        <div class="flex justify-end gap-3 pt-4 border-t border-slate-200">
                            <button class="px-4 py-2 text-sm font-medium text-slate-700 hover:bg-slate-100 rounded-lg border border-slate-300 transition-colors" onclick="testIntegration()">
                                <i class="fa-solid fa-vial mr-1"></i> Test Integration
                            </button>
                            <button class="px-4 py-2 text-sm font-medium text-white bg-brand-600 hover:bg-brand-700 rounded-lg shadow-sm transition-colors" onclick="saveIntegrationConfig()">
                                <i class="fa-solid fa-save mr-1"></i> Save Integration
                            </button>
                        </div>
                    </div>
                </section>
            `;
        }

        function testMQTT() {
            showToast('Testing MQTT connection...', 'info');
            setTimeout(() => {
                showToast('MQTT test successful! Message published successfully.', 'success');
            }, 1500);
        }

        function saveMQTTConfig() {
            showToast('MQTT configuration saved successfully', 'success');
        }

        function testEmail() {
            showToast('Sending test email...', 'info');
            setTimeout(() => {
                showToast('Test email sent successfully!', 'success');
            }, 1500);
        }

        function saveEmailConfig() {
            showToast('Email configuration saved successfully', 'success');
        }

        function testSMS() {
            showToast('Sending test SMS...', 'info');
            setTimeout(() => {
                showToast('Test SMS sent successfully!', 'success');
            }, 1500);
        }

        function saveSMSConfig() {
            showToast('SMS configuration saved successfully', 'success');
        }

        function testWebhook() {
            showToast('Testing webhook endpoint...', 'info');
            setTimeout(() => {
                showToast('Webhook test successful! Response received.', 'success');
            }, 1500);
        }

        function saveWebhookConfig() {
            showToast('Webhook configuration saved successfully', 'success');
        }

        function testPush() {
            showToast('Sending test push notification...', 'info');
            setTimeout(() => {
                showToast('Test push notification sent successfully!', 'success');
            }, 1500);
        }

        function savePushConfig() {
            showToast('Push notification configuration saved successfully', 'success');
        }

        function testIntegration() {
            showToast('Testing integration...', 'info');
            setTimeout(() => {
                showToast('Integration test successful!', 'success');
            }, 1500);
        }

        function saveIntegrationConfig() {
            showToast('Integration configuration saved successfully', 'success');
        }

        function addRecipient() {
            const input = document.getElementById('new-recipient');
            if (!input.value.trim()) return;
            
            showToast(`Added recipient: ${input.value}`, 'success');
            input.value = '';
        }

        function removeRecipient(button) {
            button.parentElement.remove();
            showToast('Recipient removed', 'warning');
        }

        function addSMSRecipient() {
            const input = document.getElementById('new-sms-recipient');
            if (!input.value.trim()) return;
            
            showToast(`Added SMS recipient: ${input.value}`, 'success');
            input.value = '';
        }

        // ========== TEMPLATE MANAGEMENT ==========
        function loadTemplates() {
            templates = [
                {
                    id: 'template-1',
                    name: 'Critical Alert Email',
                    type: 'email',
                    description: 'Template for critical email alerts',
                    content: `Alert: {{alert_name}}
Severity: {{severity}}
Value: {{value}} {{unit}}
Time: {{timestamp}}
Source: {{source}}
Location: {{location}}

Please investigate immediately.`,
                    lastModified: '2024-03-15 14:30'
                },
                {
                    id: 'template-2',
                    name: 'SMS Alert',
                    type: 'sms',
                    description: 'Short SMS template',
                    content: `Alert: {{alert_name}}
Value: {{value}}{{unit}}
Time: {{timestamp}}
Location: {{location}}`,
                    lastModified: '2024-03-14 09:15'
                },
                {
                    id: 'template-3',
                    name: 'MQTT JSON Payload',
                    type: 'mqtt',
                    description: 'JSON payload for MQTT',
                    content: `{
  "alert": "{{alert_name}}",
  "severity": "{{severity}}",
  "value": "{{value}}",
  "unit": "{{unit}}",
  "timestamp": "{{timestamp}}",
  "gateway_id": "{{gateway_id}}",
  "location": "{{location}}"
}`,
                    lastModified: '2024-03-13 16:45'
                }
            ];
            
            renderTemplatesList();
            if (templates.length > 0) {
                selectTemplate(templates[0].id);
            }
        }

        function renderTemplatesList() {
            const container = document.getElementById('templates-list');
            if (!container) return;
            
            container.innerHTML = templates.map(template => `
                <div class="template-item p-3 border border-slate-200 rounded-lg hover:border-brand-300 hover:bg-brand-50 cursor-pointer transition-all ${selectedTemplate === template.id ? 'border-brand-300 bg-brand-50' : ''}" onclick="selectTemplate('${template.id}')">
                    <div class="flex justify-between items-start mb-2">
                        <h4 class="text-sm font-medium text-slate-900">${template.name}</h4>
                        <span class="text-xs px-2 py-1 rounded ${template.type === 'email' ? 'bg-blue-100 text-blue-700' : template.type === 'sms' ? 'bg-green-100 text-green-700' : 'bg-brand-100 text-brand-700'}">
                            ${template.type.toUpperCase()}
                        </span>
                    </div>
                    <p class="text-xs text-slate-500 mb-1">${template.description}</p>
                    <div class="text-xs text-slate-400 flex items-center gap-1">
                        <i class="fa-solid fa-clock"></i>
                        Modified: ${template.lastModified}
                    </div>
                </div>
            `).join('');
        }

        function selectTemplate(templateId) {
            const template = templates.find(t => t.id === templateId);
            if (!template) return;
            
            selectedTemplate = templateId;
            renderTemplatesList();
            
            const editor = document.getElementById('template-editor');
            if (!editor) return;
            
            editor.innerHTML = `
                <div class="mb-4">
                    <div class="flex justify-between items-center mb-2">
                        <h3 class="text-lg font-semibold text-slate-800">${template.name}</h3>
                        <div class="flex gap-2">
                            <button class="text-xs text-slate-500 hover:text-slate-700" onclick="duplicateTemplate('${template.id}')">
                                <i class="fa-solid fa-copy mr-1"></i>Duplicate
                            </button>
                            <button class="text-xs text-red-500 hover:text-red-700" onclick="deleteTemplate('${template.id}')">
                                <i class="fa-solid fa-trash mr-1"></i>Delete
                            </button>
                        </div>
                    </div>
                    <p class="text-sm text-slate-600 mb-4">${template.description}</p>
                </div>
                
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-1">Template Name</label>
                        <input type="text" id="template-name" value="${template.name}" class="w-full border border-slate-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-1">Description</label>
                        <input type="text" id="template-description" value="${template.description}" class="w-full border border-slate-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-1">Template Type</label>
                        <select id="template-type" class="w-full border border-slate-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none bg-white">
                            <option value="email" ${template.type === 'email' ? 'selected' : ''}>Email</option>
                            <option value="sms" ${template.type === 'sms' ? 'selected' : ''}>SMS</option>
                            <option value="mqtt" ${template.type === 'mqtt' ? 'selected' : ''}>MQTT</option>
                            <option value="webhook" ${template.type === 'webhook' ? 'selected' : ''}>Webhook</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-1">Template Content</label>
                        <textarea id="template-content" class="w-full h-64 font-mono text-sm border border-slate-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none resize-none">${template.content}</textarea>
                    </div>
                </div>
            `;
        }

        function showCreateTemplateModal() {
            showModal(
                'Create New Template',
                `
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-1">Template Name</label>
                        <input type="text" id="new-template-name" class="w-full border border-slate-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none" placeholder="e.g., Emergency SMS Alert">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-1">Description</label>
                        <input type="text" id="new-template-description" class="w-full border border-slate-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none" placeholder="Brief description of this template">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-1">Template Type</label>
                        <select id="new-template-type" class="w-full border border-slate-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none bg-white">
                            <option value="email">Email</option>
                            <option value="sms">SMS</option>
                            <option value="mqtt">MQTT</option>
                            <option value="webhook">Webhook</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-1">Based on Existing Template</label>
                        <select id="template-base" class="w-full border border-slate-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none bg-white" onchange="loadTemplateBase(this.value)">
                            <option value="">Start from scratch</option>
                            ${templates.map(t => `<option value="${t.id}">${t.name}</option>`).join('')}
                        </select>
                    </div>
                </div>
                `,
                [
                    {
                        text: 'Cancel',
                        className: 'px-4 py-2 text-sm font-medium text-slate-700 hover:bg-slate-100 rounded-lg border border-slate-300 transition-colors',
                        onclick: 'closeModal()'
                    },
                    {
                        text: 'Create Template',
                        className: 'px-4 py-2 text-sm font-medium text-white bg-brand-600 hover:bg-brand-700 rounded-lg shadow-sm transition-colors',
                        onclick: 'createNewTemplate()'
                    }
                ]
            );
        }

        function loadTemplateBase(templateId) {
            const template = templates.find(t => t.id === templateId);
            if (!template) return;
            
            const content = document.getElementById('new-template-content');
            if (content) {
                content.value = template.content;
            }
        }

        function createNewTemplate() {
            const nameInput = document.getElementById('new-template-name');
            const descInput = document.getElementById('new-template-description');
            const typeInput = document.getElementById('new-template-type');
            const baseSelect = document.getElementById('template-base');
            
            if (!nameInput.value.trim()) {
                showToast('Please enter a template name', 'error');
                return;
            }
            
            const baseTemplate = templates.find(t => t.id === baseSelect.value);
            
            const newTemplate = {
                id: 'template-' + Date.now(),
                name: nameInput.value,
                type: typeInput.value,
                description: descInput.value || 'No description',
                content: baseTemplate ? baseTemplate.content : '',
                lastModified: new Date().toISOString().replace('T', ' ').substring(0, 16)
            };
            
            templates.push(newTemplate);
            renderTemplatesList();
            selectTemplate(newTemplate.id);
            closeModal();
            showToast(`Template "${nameInput.value}" created successfully`, 'success');
        }

        function saveTemplate() {
            if (!selectedTemplate) return;
            
            const template = templates.find(t => t.id === selectedTemplate);
            if (!template) return;
            
            const nameInput = document.getElementById('template-name');
            const descInput = document.getElementById('template-description');
            const typeInput = document.getElementById('template-type');
            const contentInput = document.getElementById('template-content');
            
            template.name = nameInput.value;
            template.description = descInput.value;
            template.type = typeInput.value;
            template.content = contentInput.value;
            template.lastModified = new Date().toISOString().replace('T', ' ').substring(0, 16);
            
            renderTemplatesList();
            showToast('Template saved successfully', 'success');
        }

        function duplicateTemplate(templateId) {
            const template = templates.find(t => t.id === templateId);
            if (!template) return;
            
            const newTemplate = {
                ...template,
                id: 'template-' + Date.now(),
                name: template.name + ' (Copy)',
                lastModified: new Date().toISOString().replace('T', ' ').substring(0, 16)
            };
            
            templates.push(newTemplate);
            renderTemplatesList();
            selectTemplate(newTemplate.id);
            showToast('Template duplicated successfully', 'success');
        }

        function deleteTemplate(templateId) {
            const template = templates.find(t => t.id === templateId);
            if (!template) return;
            
            showConfirmation(
                'Delete Template',
                `Are you sure you want to delete "${template.name}"? This action cannot be undone.`,
                () => {
                    const index = templates.findIndex(t => t.id === templateId);
                    if (index > -1) {
                        templates.splice(index, 1);
                    }
                    
                    renderTemplatesList();
                    if (templates.length > 0) {
                        selectTemplate(templates[0].id);
                    } else {
                        document.getElementById('template-editor').innerHTML = `
                            <div class="text-center py-12 text-slate-400">
                                <i class="fa-solid fa-file-lines text-4xl mb-3"></i>
                                <p>No template selected</p>
                                <p class="text-sm mt-2">Create a new template or select an existing one</p>
                            </div>
                        `;
                    }
                    
                    showToast('Template deleted successfully', 'warning');
                }
            );
        }

        function previewTemplate() {
            if (!selectedTemplate) {
                showToast('Please select a template first', 'warning');
                return;
            }
            
            const contentInput = document.getElementById('template-content');
            if (!contentInput) return;
            
            // Create sample data for preview
            const sampleData = {
                alert_name: 'High Temperature Alert',
                severity: 'CRITICAL',
                value: '85.6',
                unit: 'C',
                timestamp: '2024-03-15 14:30:22',
                source: 'CraneIQ-01',
                location: 'Factory Floor - Zone B',
                gateway_id: 'UNIVA-GW-01'
            };
            
            let preview = contentInput.value;
            for (const [key, value] of Object.entries(sampleData)) {
                preview = preview.replace(new RegExp(`{{${key}}}`, 'g'), value);
            }
            
            showModal(
                'Template Preview',
                `
                <div class="space-y-4">
                    <div class="bg-slate-50 p-4 rounded-lg border border-slate-200">
                        <h4 class="text-sm font-medium text-slate-700 mb-2">Sample Data Used:</h4>
                        <pre class="text-xs font-mono bg-white p-3 rounded border border-slate-300 overflow-x-auto">${JSON.stringify(sampleData, null, 2)}</pre>
                    </div>
                    
                    <div>
                        <h4 class="text-sm font-medium text-slate-700 mb-2">Preview Result:</h4>
                        <div class="bg-white p-4 rounded-lg border border-slate-300 font-mono text-sm whitespace-pre-wrap min-h-[200px]">
                            ${preview}
                        </div>
                    </div>
                </div>
                `,
                [
                    {
                        text: 'Close',
                        className: 'px-4 py-2 text-sm font-medium text-slate-700 hover:bg-slate-100 rounded-lg border border-slate-300 transition-colors',
                        onclick: 'closeModal()'
                    }
                ]
            );
        }

        function showAllTemplates() {
            showModal(
                'All Templates',
                `
                <div class="space-y-4">
                    <div class="flex justify-between items-center">
                        <input type="text" id="template-search" class="w-64 border border-slate-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none" placeholder="Search templates..." onkeyup="filterTemplateList()">
                        <button class="px-3 py-2 text-sm bg-brand-600 text-white rounded-lg hover:bg-brand-700" onclick="showCreateTemplateModal()">
                            <i class="fa-solid fa-plus mr-1"></i> New Template
                        </button>
                    </div>
                    
                    <div class="overflow-y-auto max-h-96">
                        <table class="w-full text-sm text-left">
                            <thead class="sticky top-0 bg-slate-50">
                                <tr>
                                    <th class="px-4 py-2 font-medium text-slate-500">Name</th>
                                    <th class="px-4 py-2 font-medium text-slate-500">Type</th>
                                    <th class="px-4 py-2 font-medium text-slate-500">Last Modified</th>
                                    <th class="px-4 py-2 font-medium text-slate-500 text-right">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="all-templates-list" class="divide-y divide-slate-100">
                                ${templates.map(t => `
                                    <tr class="hover:bg-slate-50">
                                        <td class="px-4 py-3">
                                            <div class="font-medium text-slate-900">${t.name}</div>
                                            <div class="text-xs text-slate-500">${t.description}</div>
                                        </td>
                                        <td class="px-4 py-3">
                                            <span class="px-2 py-1 rounded text-xs ${t.type === 'email' ? 'bg-blue-100 text-blue-700' : t.type === 'sms' ? 'bg-green-100 text-green-700' : 'bg-brand-100 text-brand-700'}">
                                                ${t.type.toUpperCase()}
                                            </span>
                                        </td>
                                        <td class="px-4 py-3 text-slate-500">${t.lastModified}</td>
                                        <td class="px-4 py-3 text-right">
                                            <button class="text-slate-400 hover:text-brand-600 px-2" onclick="selectTemplate('${t.id}'); closeModal();">
                                                <i class="fa-solid fa-eye"></i>
                                            </button>
                                            <button class="text-slate-400 hover:text-blue-600 px-2" onclick="selectTemplate('${t.id}'); closeModal();">
                                                <i class="fa-solid fa-pen"></i>
                                            </button>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
                `,
                [
                    {
                        text: 'Close',
                        className: 'px-4 py-2 text-sm font-medium text-slate-700 hover:bg-slate-100 rounded-lg border border-slate-300 transition-colors',
                        onclick: 'closeModal()'
                    }
                ],
                '800px'
            );
        }

        function filterTemplateList() {
            const searchInput = document.getElementById('template-search');
            const searchTerm = searchInput.value.toLowerCase();
            const rows = document.querySelectorAll('#all-templates-list tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        }

        // ========== ROUTING RULE FUNCTIONS ==========
        function loadRoutingRules() {
            routingRules = [
                {
                    id: 'rule-1',
                    alertClass: 'Critical',
                    channels: ['mqtt', 'email', 'sms', 'push'],
                    condition: 'Always',
                    throttling: '10 sec',
                    escalation: 'After 30 sec'
                },
                {
                    id: 'rule-2',
                    alertClass: 'Warning',
                    channels: ['mqtt', 'email'],
                    condition: 'value > 50',
                    throttling: '30 sec',
                    escalation: 'After 5 min'
                },
                {
                    id: 'rule-3',
                    alertClass: 'Info',
                    channels: ['mqtt'],
                    condition: '--',
                    throttling: '1 min',
                    escalation: 'None'
                }
            ];
            
            renderRoutingRules();
        }

        function renderRoutingRules() {
            const container = document.getElementById('routing-rules-list');
            if (!container) return;
            
            container.innerHTML = routingRules.map(rule => `
                <tr class="log-row">
                    <td class="px-6 py-4">
                        <span class="font-medium text-slate-900">${rule.alertClass}</span>
                    </td>
                    <td class="px-6 py-4">
                        <div class="flex flex-wrap gap-1">
                            ${rule.channels.map(channel => `
                                <span class="inline-flex items-center px-2 py-1 rounded text-xs font-medium 
                                    ${channel === 'mqtt' ? 'bg-brand-100 text-brand-700' :
                                      channel === 'email' ? 'bg-blue-100 text-blue-700' :
                                      channel === 'sms' ? 'bg-green-100 text-green-700' :
                                      channel === 'push' ? 'bg-orange-100 text-orange-700' :
                                      'bg-slate-100 text-slate-700'}">
                                    ${channel}
                                </span>
                            `).join('')}
                        </div>
                    </td>
                    <td class="px-6 py-4 text-slate-600 text-sm">${rule.condition}</td>
                    <td class="px-6 py-4 text-slate-600 text-sm">${rule.throttling}</td>
                    <td class="px-6 py-4 text-slate-600 text-sm">${rule.escalation}</td>
                    <td class="px-6 py-4 text-right">
                        <button class="text-slate-400 hover:text-brand-600 px-2" onclick="editRoutingRule('${rule.id}')">
                            <i class="fa-solid fa-pen"></i>
                        </button>
                        <button class="text-slate-400 hover:text-red-500 px-2" onclick="deleteRoutingRule('${rule.id}')">
                            <i class="fa-solid fa-trash"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        function showAddRoutingRuleModal() {
            showModal(
                'Add Routing Rule',
                `
                <div class="space-y-6">
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">Alert Class</label>
                        <select class="w-full border border-slate-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none bg-white">
                            <option>Critical</option>
                            <option>Warning</option>
                            <option>Info</option>
                            <option>Custom</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">Apply Channels</label>
                        <div class="grid grid-cols-2 gap-2">
                            <label class="flex items-center gap-2 p-2 border border-slate-200 rounded hover:bg-slate-50 cursor-pointer">
                                <input type="checkbox" checked class="rounded border-slate-300 text-brand-600 focus:ring-brand-500">
                                <span class="text-sm text-slate-600">MQTT</span>
                            </label>
                            <label class="flex items-center gap-2 p-2 border border-slate-200 rounded hover:bg-slate-50 cursor-pointer">
                                <input type="checkbox" checked class="rounded border-slate-300 text-brand-600 focus:ring-brand-500">
                                <span class="text-sm text-slate-600">Email</span>
                            </label>
                            <label class="flex items-center gap-2 p-2 border border-slate-200 rounded hover:bg-slate-50 cursor-pointer">
                                <input type="checkbox" checked class="rounded border-slate-300 text-brand-600 focus:ring-brand-500">
                                <span class="text-sm text-slate-600">SMS</span>
                            </label>
                            <label class="flex items-center gap-2 p-2 border border-slate-200 rounded hover:bg-slate-50 cursor-pointer">
                                <input type="checkbox" class="rounded border-slate-300 text-brand-600 focus:ring-brand-500">
                                <span class="text-sm text-slate-600">Push</span>
                            </label>
                            <label class="flex items-center gap-2 p-2 border border-slate-200 rounded hover:bg-slate-50 cursor-pointer">
                                <input type="checkbox" class="rounded border-slate-300 text-brand-600 focus:ring-brand-500">
                                <span class="text-sm text-slate-600">Webhook</span>
                            </label>
                            <label class="flex items-center gap-2 p-2 border border-slate-200 rounded hover:bg-slate-50 cursor-pointer">
                                <input type="checkbox" class="rounded border-slate-300 text-brand-600 focus:ring-brand-500">
                                <span class="text-sm text-slate-600">Third-Party</span>
                            </label>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">Optional Conditions</label>
                        <div class="space-y-3">
                            <div class="flex items-center gap-2">
                                <select class="border border-slate-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none bg-white">
                                    <option>IF value</option>
                                    <option>IF source</option>
                                    <option>IF location</option>
                                </select>
                                <select class="border border-slate-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none bg-white">
                                    <option>></option>
                                    <option><</option>
                                    <option>=</option>
                                    <option>!=</option>
                                </select>
                                <input type="text" class="flex-1 border border-slate-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none" placeholder="50">
                            </div>
                            <div class="flex items-center gap-2">
                                <select class="border border-slate-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none bg-white">
                                    <option>AND</option>
                                    <option>OR</option>
                                </select>
                                <select class="border border-slate-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none bg-white">
                                    <option>source</option>
                                    <option>location</option>
                                    <option>operator</option>
                                </select>
                                <select class="border border-slate-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none bg-white">
                                    <option>=</option>
                                    <option>!=</option>
                                </select>
                                <input type="text" class="flex-1 border border-slate-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none" placeholder="CraneIQ">
                            </div>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-1">Throttling (Min interval)</label>
                            <input type="number" value="10" class="w-full border border-slate-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none">
                            <p class="text-xs text-slate-500 mt-1">Seconds between alerts</p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-1">Escalation Timeout</label>
                            <input type="number" value="30" class="w-full border border-slate-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none">
                            <p class="text-xs text-slate-500 mt-1">Seconds before escalation</p>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-1">Escalation Target</label>
                        <input type="email" class="w-full border border-slate-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none" placeholder="second-operator@example.com">
                        <p class="text-xs text-slate-500 mt-1">Send to this contact if not acknowledged</p>
                    </div>
                </div>
                `,
                [
                    {
                        text: 'Cancel',
                        className: 'px-4 py-2 text-sm font-medium text-slate-700 hover:bg-slate-100 rounded-lg border border-slate-300 transition-colors',
                        onclick: 'closeModal()'
                    },
                    {
                        text: 'Add Rule',
                        className: 'px-4 py-2 text-sm font-medium text-white bg-brand-600 hover:bg-brand-700 rounded-lg shadow-sm transition-colors',
                        onclick: 'addRoutingRule()'
                    }
                ]
            );
        }

        function addRoutingRule() {
            const newRule = {
                id: 'rule-' + Date.now(),
                alertClass: 'Custom',
                channels: ['mqtt', 'email'],
                condition: 'Custom condition',
                throttling: '15 sec',
                escalation: 'After 1 min'
            };
            
            routingRules.push(newRule);
            renderRoutingRules();
            closeModal();
            showToast('Routing rule added successfully', 'success');
        }

        function editRoutingRule(ruleId) {
            const rule = routingRules.find(r => r.id === ruleId);
            if (!rule) return;
            
            showModal(
                `Edit Routing Rule for ${rule.alertClass}`,
                `
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">Alert Class</label>
                        <select class="w-full border border-slate-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none bg-white">
                            <option ${rule.alertClass === 'Critical' ? 'selected' : ''}>Critical</option>
                            <option ${rule.alertClass === 'Warning' ? 'selected' : ''}>Warning</option>
                            <option ${rule.alertClass === 'Info' ? 'selected' : ''}>Info</option>
                            <option ${rule.alertClass === 'Custom' ? 'selected' : ''}>Custom</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">Throttling (Min interval)</label>
                        <input type="number" value="${parseInt(rule.throttling)}" class="w-full border border-slate-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none">
                        <p class="text-xs text-slate-500 mt-1">Seconds between alerts</p>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">Escalation Timeout</label>
                        <input type="number" value="${parseInt(rule.escalation)}" class="w-full border border-slate-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none">
                        <p class="text-xs text-slate-500 mt-1">Seconds before escalation</p>
                    </div>
                </div>
                `,
                [
                    {
                        text: 'Cancel',
                        className: 'px-4 py-2 text-sm font-medium text-slate-700 hover:bg-slate-100 rounded-lg border border-slate-300 transition-colors',
                        onclick: 'closeModal()'
                    },
                    {
                        text: 'Save Changes',
                        className: 'px-4 py-2 text-sm font-medium text-white bg-brand-600 hover:bg-brand-700 rounded-lg shadow-sm transition-colors',
                        onclick: `saveRoutingRuleEdit('${ruleId}')`
                    }
                ]
            );
        }

        function saveRoutingRuleEdit(ruleId) {
            const rule = routingRules.find(r => r.id === ruleId);
            if (!rule) return;
            
            // In a real app, you would get values from form inputs
            showToast('Routing rule updated successfully', 'success');
            closeModal();
        }

        function deleteRoutingRule(ruleId) {
            const rule = routingRules.find(r => r.id === ruleId);
            if (!rule) return;
            
            showConfirmation(
                'Delete Routing Rule',
                `Are you sure you want to delete the routing rule for ${rule.alertClass} alerts?`,
                () => {
                    const index = routingRules.findIndex(r => r.id === ruleId);
                    if (index > -1) {
                        routingRules.splice(index, 1);
                    }
                    renderRoutingRules();
                    showToast('Routing rule deleted successfully', 'warning');
                }
            );
        }

        function editEscalationPolicies() {
            showModal(
                'Edit Escalation Policies',
                `
                <div class="space-y-6">
                    <div class="bg-slate-50 p-4 rounded-lg border border-slate-200">
                        <h3 class="text-sm font-medium text-slate-700 mb-3">Level 1 - Immediate</h3>
                        <div class="space-y-3">
                            <div>
                                <label class="block text-xs font-medium text-slate-500 mb-1">Contacts</label>
                                <input type="text" value="ops-team@example.com, supervisor@example.com" class="w-full border border-slate-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none">
                            </div>
                            <div>
                                <label class="block text-xs font-medium text-slate-500 mb-1">Channels</label>
                                <div class="flex flex-wrap gap-2">
                                    <label class="flex items-center gap-1">
                                        <input type="checkbox" checked class="rounded border-slate-300 text-brand-600 focus:ring-brand-500">
                                        <span class="text-xs text-slate-600">Email</span>
                                    </label>
                                    <label class="flex items-center gap-1">
                                        <input type="checkbox" checked class="rounded border-slate-300 text-brand-600 focus:ring-brand-500">
                                        <span class="text-xs text-slate-600">SMS</span>
                                    </label>
                                    <label class="flex items-center gap-1">
                                        <input type="checkbox" class="rounded border-slate-300 text-brand-600 focus:ring-brand-500">
                                        <span class="text-xs text-slate-600">Push</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-slate-50 p-4 rounded-lg border border-slate-200">
                        <h3 class="text-sm font-medium text-slate-700 mb-3">Level 2 - Escalated</h3>
                        <div class="space-y-3">
                            <div class="grid grid-cols-2 gap-3">
                                <div>
                                    <label class="block text-xs font-medium text-slate-500 mb-1">Trigger Time</label>
                                    <input type="number" value="5" class="w-full border border-slate-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none">
                                    <span class="text-xs text-slate-500">minutes after Level 1</span>
                                </div>
                                <div>
                                    <label class="block text-xs font-medium text-slate-500 mb-1">Contacts</label>
                                    <input type="text" value="management@example.com" class="w-full border border-slate-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none">
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-slate-50 p-4 rounded-lg border border-slate-200">
                        <h3 class="text-sm font-medium text-slate-700 mb-3">Level 3 - Critical</h3>
                        <div class="space-y-3">
                            <div class="grid grid-cols-2 gap-3">
                                <div>
                                    <label class="block text-xs font-medium text-slate-500 mb-1">Trigger Time</label>
                                    <input type="number" value="15" class="w-full border border-slate-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none">
                                    <span class="text-xs text-slate-500">minutes after Level 1</span>
                                </div>
                                <div>
                                    <label class="block text-xs font-medium text-slate-500 mb-1">Contacts</label>
                                    <input type="text" value="emergency-team@example.com, +911234567890" class="w-full border border-slate-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-brand-500 focus:border-brand-500 outline-none">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                `,
                [
                    {
                        text: 'Cancel',
                        className: 'px-4 py-2 text-sm font-medium text-slate-700 hover:bg-slate-100 rounded-lg border border-slate-300 transition-colors',
                        onclick: 'closeModal()'
                    },
                    {
                        text: 'Save Policies',
                        className: 'px-4 py-2 text-sm font-medium text-white bg-brand-600 hover:bg-brand-700 rounded-lg shadow-sm transition-colors',
                        onclick: 'saveEscalationPolicies()'
                    }
                ]
            );
        }

        function saveEscalationPolicies() {
            showToast('Escalation policies updated successfully', 'success');
            closeModal();
        }

        // ========== DELIVERY LOGS ==========
        function loadNotificationLogs() {
            notificationLogs = [
                {
                    id: 'log-1',
                    time: '12:45:01',
                    channel: 'Email',
                    alertName: 'Overload',
                    alertClass: 'Critical',
                    status: 'sent',
                    details: 'Sent to ops-team@example.com'
                },
                {
                    id: 'log-2',
                    time: '12:45:02',
                    channel: 'SMS',
                    alertName: 'Overload',
                    alertClass: 'Critical',
                    status: 'failed',
                    details: 'Network error'
                },
                {
                    id: 'log-3',
                    time: '12:45:03',
                    channel: 'MQTT',
                    alertName: 'Overload',
                    alertClass: 'Critical',
                    status: 'delivered',
                    details: 'Published to device/alerts'
                },
                {
                    id: 'log-4',
                    time: '12:40:15',
                    channel: 'Webhook',
                    alertName: 'High Temperature',
                    alertClass: 'Warning',
                    status: 'pending',
                    details: 'Retry in 5 seconds'
                },
                {
                    id: 'log-5',
                    time: '12:35:22',
                    channel: 'Push',
                    alertName: 'Low Battery',
                    alertClass: 'Info',
                    status: 'delivered',
                    details: 'Device acknowledged'
                }
            ];
            
            renderNotificationLogs();
        }

        function renderNotificationLogs() {
            const container = document.getElementById('notification-logs');
            if (!container) return;
            
            container.innerHTML = notificationLogs.map(log => `
                <tr class="log-row">
                    <td class="px-6 py-4 font-mono text-sm text-slate-600">${log.time}</td>
                    <td class="px-6 py-4">
                        <div class="flex items-center gap-2">
                            <i class="fa-solid ${log.channel === 'Email' ? 'fa-envelope text-blue-500' :
                                              log.channel === 'SMS' ? 'fa-comment-sms text-green-500' :
                                              log.channel === 'MQTT' ? 'fa-satellite-dish text-brand-500' :
                                              log.channel === 'Webhook' ? 'fa-code-branch text-purple-500' :
                                              'fa-bell text-orange-500'}"></i>
                            <span class="text-slate-700">${log.channel}</span>
                        </div>
                    </td>
                    <td class="px-6 py-4 font-medium text-slate-900">${log.alertName}</td>
                    <td class="px-6 py-4">
                        <span class="inline-flex items-center px-2 py-1 rounded text-xs font-medium 
                            ${log.alertClass === 'Critical' ? 'bg-red-100 text-red-700' :
                              log.alertClass === 'Warning' ? 'bg-yellow-100 text-yellow-700' :
                              'bg-blue-100 text-blue-700'}">
                            ${log.alertClass}
                        </span>
                    </td>
                    <td class="px-6 py-4">
                        <span class="status-badge status-${log.status}">
                            ${log.status.charAt(0).toUpperCase() + log.status.slice(1)}
                        </span>
                    </td>
                    <td class="px-6 py-4 text-sm text-slate-500">${log.details}</td>
                </tr>
            `).join('');
            
            document.getElementById('log-count').textContent = notificationLogs.length;
            document.getElementById('log-total').textContent = '124';
        }

        function filterLogs() {
            const channelFilter = document.getElementById('log-channel-filter').value;
            const classFilter = document.getElementById('log-class-filter').value;
            const statusFilter = document.getElementById('log-status-filter').value;
            const dateFilter = document.getElementById('log-date-filter').value;
            
            let filteredLogs = notificationLogs;
            
            if (channelFilter) {
                filteredLogs = filteredLogs.filter(log => log.channel.toLowerCase() === channelFilter.toLowerCase());
            }
            
            if (classFilter) {
                filteredLogs = filteredLogs.filter(log => log.alertClass.toLowerCase() === classFilter.toLowerCase());
            }
            
            if (statusFilter) {
                filteredLogs = filteredLogs.filter(log => log.status.toLowerCase() === statusFilter.toLowerCase());
            }
            
            if (dateFilter) {
                // In a real app, you would filter by date
            }
            
            renderFilteredLogs(filteredLogs);
        }

        function renderFilteredLogs(filteredLogs) {
            const container = document.getElementById('notification-logs');
            if (!container) return;
            
            container.innerHTML = filteredLogs.map(log => `
                <tr class="log-row">
                    <td class="px-6 py-4 font-mono text-sm text-slate-600">${log.time}</td>
                    <td class="px-6 py-4">
                        <div class="flex items-center gap-2">
                            <i class="fa-solid ${log.channel === 'Email' ? 'fa-envelope text-blue-500' :
                                              log.channel === 'SMS' ? 'fa-comment-sms text-green-500' :
                                              log.channel === 'MQTT' ? 'fa-satellite-dish text-brand-500' :
                                              log.channel === 'Webhook' ? 'fa-code-branch text-purple-500' :
                                              'fa-bell text-orange-500'}"></i>
                            <span class="text-slate-700">${log.channel}</span>
                        </div>
                    </td>
                    <td class="px-6 py-4 font-medium text-slate-900">${log.alertName}</td>
                    <td class="px-6 py-4">
                        <span class="inline-flex items-center px-2 py-1 rounded text-xs font-medium 
                            ${log.alertClass === 'Critical' ? 'bg-red-100 text-red-700' :
                              log.alertClass === 'Warning' ? 'bg-yellow-100 text-yellow-700' :
                              'bg-blue-100 text-blue-700'}">
                            ${log.alertClass}
                        </span>
                    </td>
                    <td class="px-6 py-4">
                        <span class="status-badge status-${log.status}">
                            ${log.status.charAt(0).toUpperCase() + log.status.slice(1)}
                        </span>
                    </td>
                    <td class="px-6 py-4 text-sm text-slate-500">${log.details}</td>
                </tr>
            `).join('');
            
            document.getElementById('log-count').textContent = filteredLogs.length;
        }

        function exportLogs() {
            showConfirmation(
                'Export Logs',
                'Export all notification logs as CSV file?',
                () => {
                    // In a real app, you would generate and download CSV
                    showToast('Logs exported successfully', 'success');
                }
            );
        }

        function refreshLogs() {
            showToast('Refreshing logs...', 'info');
            
            setTimeout(() => {
                const newLog = {
                    id: 'log-' + Date.now(),
                    time: new Date().toTimeString().split(' ')[0],
                    channel: ['MQTT', 'Email', 'SMS', 'Webhook'][Math.floor(Math.random() * 4)],
                    alertName: ['Overload', 'High Temperature', 'Low Battery', 'Connection Lost'][Math.floor(Math.random() * 4)],
                    alertClass: ['Critical', 'Warning', 'Info'][Math.floor(Math.random() * 3)],
                    status: ['sent', 'delivered', 'failed', 'pending'][Math.floor(Math.random() * 4)],
                    details: 'Test refresh'
                };
                
                notificationLogs.unshift(newLog);
                renderNotificationLogs();
                showToast('Logs refreshed successfully', 'success');
            }, 1000);
        }

        // ========== HELPER FUNCTIONS ==========
        function updateStatistics() {
            document.getElementById('total-sent').textContent = notificationStats.totalSent.toLocaleString();
            document.getElementById('delivery-rate').textContent = notificationStats.deliveryRate.toFixed(1) + '%';
            document.getElementById('response-time').textContent = notificationStats.responseTime.toFixed(1) + 's';
            document.getElementById('failed-attempts').textContent = notificationStats.failedAttempts;
        }

        function saveConfiguration() {
            showToast('Configuration saved successfully!', 'success');
        }

        function resetConfiguration() {
            showConfirmation(
                'Reset Configuration',
                'Reset all notification settings to defaults?',
                () => {
                    showToast('Configuration reset', 'warning');
                }
            );
        }

        function cancelChanges() {
            showConfirmation(
                'Cancel Changes',
                'Discard all unsaved changes?',
                () => {
                    window.location.reload();
                }
            );
        }

        // ========== INITIALIZATION ==========
        document.addEventListener('DOMContentLoaded', function() {
            loadSidebar();
            loadChannels();
            loadTemplates();
            loadRoutingRules();
            updateStatistics();
            
            // Initialize gateway select
            const gatewaySelect = document.getElementById('gateway-select');
            if (gatewaySelect) {
                gatewaySelect.addEventListener('change', function() {
                    showConfirmation(
                        'Switch Gateway',
                        'Switch to another gateway? Unsaved changes will be lost.',
                        () => {
                            location.reload();
                        }
                    );
                });
            }
            
            // Add click outside handler for sidebar
            document.addEventListener('click', handleSidebarClickOutside);
            
            // Initial responsive setup
            setTimeout(() => {
                if (window.innerWidth <= 1024) {
                    document.getElementById('sidebar')?.classList.add('active');
                }
            }, 100);
        });

        // Handle keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            // Ctrl+S to save
            if (e.ctrlKey && e.key === 's') {
                e.preventDefault();
                saveConfiguration();
            }
            
            // Escape to close modals
            if (e.key === 'Escape') {
                closeModal();
                closeConfirmation();
            }
        });
    </script>
</body>
</html>