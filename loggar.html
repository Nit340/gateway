<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Device-Level Logging - Univa Gateway</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        window.FontAwesomeConfig = { autoReplaceSvg: 'nest' };
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#2563EB',
                        primaryHover: '#1D4ED8',
                        secondary: '#475569',
                        success: '#10B981',
                        warning: '#F59E0B',
                        danger: '#EF4444',
                        info: '#3B82F6',
                        surface: '#F8FAFC',
                        card: '#FFFFFF',
                        border: '#E2E8F0',
                        logCritical: '#DC2626',
                        logError: '#EF4444',
                        logWarning: '#F59E0B',
                        logInfo: '#3B82F6',
                        logDebug: '#6B7280',
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace']
                    }
                }
            }
        };
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        ::-webkit-scrollbar { width: 4px; height: 4px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #CBD5E1; border-radius: 2px; }
        ::-webkit-scrollbar-thumb:hover { background: #94A3B8; }
        body { font-family: 'Inter', sans-serif; background-color: #F1F5F9; color: #1E293B; }
        
        .compact-input {
            padding: 8px 12px;
            font-size: 14px;
            border-radius: 6px;
            border: 1px solid #E2E8F0;
            transition: all 0.2s;
        }
        
        .compact-input:focus {
            outline: none;
            border-color: #2563EB;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }
        
        .compact-select {
            padding: 8px 12px;
            font-size: 14px;
            border-radius: 6px;
            border: 1px solid #E2E8F0;
            background-color: white;
        }
        
        .compact-select:focus {
            outline: none;
            border-color: #2563EB;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }
        
        .compact-button {
            padding: 8px 16px;
            font-size: 14px;
            border-radius: 6px;
            font-weight: 500;
            transition: all 0.2s;
        }
        
        /* Toggle Switch */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 44px;
            height: 24px;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #CBD5E1;
            transition: .4s;
            border-radius: 24px;
        }
        
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .toggle-slider {
            background-color: #2563EB;
        }
        
        input:checked + .toggle-slider:before {
            transform: translateX(20px);
        }
        
        /* Log Level Badges */
        .log-badge {
            font-size: 10px;
            padding: 2px 8px;
            border-radius: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .log-badge.critical {
            background: #FEE2E2;
            color: #DC2626;
            border: 1px solid #FECACA;
        }
        
        .log-badge.error {
            background: #FEE2E2;
            color: #EF4444;
            border: 1px solid #FECACA;
        }
        
        .log-badge.warning {
            background: #FEF3C7;
            color: #D97706;
            border: 1px solid #FDE68A;
        }
        
        .log-badge.info {
            background: #DBEAFE;
            color: #1E40AF;
            border: 1px solid #BFDBFE;
        }
        
        .log-badge.debug {
            background: #F3F4F6;
            color: #4B5563;
            border: 1px solid #E5E7EB;
        }
        
        /* Card Styles */
        .config-card {
            background: white;
            border-radius: 8px;
            border: 1px solid #E2E8F0;
            padding: 20px;
            margin-bottom: 16px;
        }
        
        .config-card-header {
            border-bottom: 1px solid #E2E8F0;
            padding-bottom: 12px;
            margin-bottom: 16px;
        }
        
        /* Modal Styles */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal-overlay.active {
            display: flex;
        }
        
        .modal {
            background: white;
            border-radius: 8px;
            box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1);
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        /* Live Log Viewer Styles */
        .log-line {
            font-family: 'JetBrains Mono', monospace;
            font-size: 12px;
            padding: 4px 8px;
            border-bottom: 1px solid #F1F5F9;
        }
        
        .log-line:hover {
            background: #F8FAFC;
        }
        
        .log-time {
            color: #64748B;
            min-width: 90px;
        }
        
        .log-level {
            min-width: 70px;
            text-align: center;
        }
        
        .log-module {
            color: #7C3AED;
            min-width: 100px;
        }
        
        .log-message {
            flex: 1;
            color: #1E293B;
        }
        
        /* Progress Bar */
        .storage-progress {
            height: 8px;
            background: #E2E8F0;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 8px;
        }
        
        .storage-progress-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.3s ease;
        }
        
        .storage-progress-fill.low {
            background: #10B981;
        }
        
        .storage-progress-fill.medium {
            background: #F59E0B;
        }
        
        .storage-progress-fill.high {
            background: #EF4444;
        }
    </style>
</head>
<body class="min-h-screen bg-slate-50">
    
    <!-- Sidebar will be inserted here by JavaScript -->
    <div id="sidebar-container"></div>

    <!-- Live Log Viewer Modal -->
    <div class="modal-overlay" id="liveLogsModal">
        <div class="modal">
            <div class="p-6">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-xl font-semibold text-slate-800 flex items-center">
                        <i class="fa-solid fa-terminal mr-3 text-primary"></i>
                        Live Log Viewer
                    </h2>
                    <div class="flex items-center space-x-3">
                        <button class="text-slate-500 hover:text-slate-700 font-medium text-sm px-3 py-1.5 rounded-lg hover:bg-slate-100 transition-colors" id="pauseLogsBtn">
                            <i class="fa-solid fa-pause mr-2"></i> Pause
                        </button>
                        <button class="text-slate-500 hover:text-slate-700 font-medium text-sm px-3 py-1.5 rounded-lg hover:bg-slate-100 transition-colors" id="clearLogsBtn">
                            <i class="fa-solid fa-trash mr-2"></i> Clear
                        </button>
                        <button class="text-slate-400 hover:text-slate-600" id="closeLiveLogsModal">
                            <i class="fa-solid fa-xmark text-lg"></i>
                        </button>
                    </div>
                </div>
                
                <!-- Log Controls -->
                <div class="bg-slate-50 p-4 rounded-lg mb-4">
                    <div class="flex items-center space-x-4">
                        <div class="flex-1">
                            <label class="block text-xs font-medium text-slate-700 mb-1">Filter by Level</label>
                            <div class="flex flex-wrap gap-2">
                                <label class="flex items-center space-x-1 cursor-pointer">
                                    <input type="checkbox" class="rounded border-slate-300 text-primary focus:ring-primary" checked id="filterCritical">
                                    <span class="log-badge critical text-xs">CRITICAL</span>
                                </label>
                                <label class="flex items-center space-x-1 cursor-pointer">
                                    <input type="checkbox" class="rounded border-slate-300 text-primary focus:ring-primary" checked id="filterError">
                                    <span class="log-badge error text-xs">ERROR</span>
                                </label>
                                <label class="flex items-center space-x-1 cursor-pointer">
                                    <input type="checkbox" class="rounded border-slate-300 text-primary focus:ring-primary" checked id="filterWarning">
                                    <span class="log-badge warning text-xs">WARN</span>
                                </label>
                                <label class="flex items-center space-x-1 cursor-pointer">
                                    <input type="checkbox" class="rounded border-slate-300 text-primary focus:ring-primary" id="filterInfo">
                                    <span class="log-badge info text-xs">INFO</span>
                                </label>
                                <label class="flex items-center space-x-1 cursor-pointer">
                                    <input type="checkbox" class="rounded border-slate-300 text-primary focus:ring-primary" id="filterDebug">
                                    <span class="log-badge debug text-xs">DEBUG</span>
                                </label>
                            </div>
                        </div>
                        <div>
                            <label class="block text-xs font-medium text-slate-700 mb-1">Search</label>
                            <input type="text" placeholder="Search logs..." class="compact-input text-sm w-48" id="logSearch">
                        </div>
                    </div>
                </div>
                
                <!-- Log Viewer -->
                <div class="bg-slate-900 rounded-lg p-4 font-mono text-sm">
                    <div class="text-slate-400 mb-2 text-xs flex justify-between">
                        <span>Live log stream (showing last 1000 lines)</span>
                        <span id="logCount">0 logs</span>
                    </div>
                    <div class="h-[500px] overflow-y-auto bg-black rounded p-4" id="logViewer">
                        <!-- Log lines will be populated here -->
                        <div class="text-slate-500 italic">Connecting to log stream...</div>
                    </div>
                </div>
                
                <!-- Footer -->
                <div class="mt-4 flex justify-between items-center text-sm text-slate-500">
                    <div>
                        <i class="fa-solid fa-circle-info mr-1"></i>
                        Logs are streamed via WebSocket from /var/log/live
                    </div>
                    <div class="flex items-center space-x-4">
                        <button class="text-primary hover:text-primaryHover font-medium" id="exportLogsBtn">
                            <i class="fa-solid fa-download mr-1"></i> Export
                        </button>
                        <div class="h-4 w-px bg-slate-300"></div>
                        <button class="compact-button border border-slate-300 text-slate-700 hover:bg-slate-50" id="closeModalBtn">
                            Close
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content Container -->
    <div class="main-content-with-sidebar">
        <!-- Header -->
        <header id="header" class="bg-white border-b border-border sticky top-0 z-30 shadow-sm">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between">
                <!-- Left: Logo & Breadcrumb -->
                <div class="flex items-center space-x-4">
                    <div class="hidden md:flex items-center text-sm text-slate-500 h-6">
                        <span><i class="fa-solid fa-gear mr-2"></i>Configuration</span>
                        <i class="fa-solid fa-chevron-right text-xs mx-2"></i>
                        <span class="text-slate-900 font-medium" id="page-title">Device-Level Logging</span>
                    </div>
                </div>

                <!-- Right: Controls -->
                <div class="flex items-center space-x-4">
                    <div class="relative hidden sm:block">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <i class="fa-solid fa-server text-slate-400 text-sm"></i>
                        </div>
                        <select id="gateway-select" class="pl-9 pr-8 py-1.5 text-sm border border-slate-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary bg-slate-50 text-slate-700 font-medium cursor-pointer hover:bg-white transition-colors">
                            <option>Univa-GW-01</option>
                            <option>Univa-GW-02</option>
                            <option>Univa-GW-03</option>
                        </select>
                    </div>
                    <div class="h-6 w-px bg-slate-200 mx-2 hidden sm:block"></div>
                    <button class="text-slate-500 hover:text-slate-700 font-medium text-sm px-3 py-1.5 rounded-lg hover:bg-slate-100 transition-colors">
                        <i class="fa-solid fa-circle-question mr-2"></i> Help
                    </button>
                  
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="flex-grow">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
                <!-- Page Header -->
                <div class="mb-8">
                    <div class="flex items-center justify-between">
                        <div>
                            <h1 class="text-2xl font-bold text-slate-900">Device-Level Logging</h1>
                            <p class="text-slate-500 text-sm mt-1">
                                Configure system-level, hardware-level, and runtime logging for debugging gateway issues
                            </p>
                        </div>
                        <div class="flex items-center space-x-2">
                            <button class="compact-button border border-slate-300 text-slate-700 hover:bg-slate-50 flex items-center" id="viewLiveLogsBtn">
                                <i class="fa-solid fa-terminal mr-2 text-sm"></i> View Live Logs
                            </button>
                            <button class="compact-button border border-slate-300 text-slate-700 hover:bg-slate-50 flex items-center" id="downloadLogsBtn">
                                <i class="fa-solid fa-download mr-2 text-sm"></i> Download Logs
                            </button>
                        </div>
                    </div>
                    
                    <!-- Info Box -->
                    <div class="mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg">
                        <div class="flex">
                            <div class="flex-shrink-0">
                                <i class="fa-solid fa-circle-info text-blue-500 mt-1"></i>
                            </div>
                            <div class="ml-3">
                                <h3 class="text-sm font-medium text-blue-800">
                                    Device-Level vs Application-Level Logging
                                </h3>
                                <div class="mt-1 text-sm text-blue-700">
                                    <p>
                                        This page configures <strong>system-level, hardware-level, and runtime logging</strong> for debugging gateway issues. 
                                        This includes CPU events, network failures, CAN/Modbus communication, sensor data issues, process crashes, and firmware errors.
                                    </p>
                                    <p class="mt-1">
                                        For application-level logs (data flow, rules engine, CraneIQ), see the separate "Logging & Analytics" section.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Current Log Status -->
                <div class="grid grid-cols-1 lg:grid-cols-4 gap-6 mb-8">
                    <div class="config-card">
                        <h3 class="text-sm font-semibold text-slate-900 mb-4 flex items-center">
                            <i class="fa-solid fa-hard-drive mr-2 text-slate-500"></i> Storage Usage
                        </h3>
                        <div class="mb-2">
                            <div class="flex justify-between text-sm">
                                <span class="text-slate-600">Log Storage</span>
                                <span class="font-medium">156 MB / 300 MB</span>
                            </div>
                            <div class="storage-progress">
                                <div class="storage-progress-fill medium" style="width: 52%"></div>
                            </div>
                        </div>
                        <div class="text-xs text-slate-500 mt-2">
                            <i class="fa-solid fa-circle-exclamation mr-1"></i>
                            52% used, 144 MB available
                        </div>
                    </div>
                    
                    <div class="config-card">
                        <h3 class="text-sm font-semibold text-slate-900 mb-4 flex items-center">
                            <i class="fa-solid fa-file-lines mr-2 text-slate-500"></i> Log Files
                        </h3>
                        <div class="space-y-2">
                            <div class="flex justify-between text-sm">
                                <span class="text-slate-600">Active Files</span>
                                <span class="font-medium">8</span>
                            </div>
                            <div class="flex justify-between text-sm">
                                <span class="text-slate-600">Compressed Files</span>
                                <span class="font-medium">12</span>
                            </div>
                            <div class="flex justify-between text-sm">
                                <span class="text-slate-600">Total Lines Today</span>
                                <span class="font-medium">42,156</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="config-card">
                        <h3 class="text-sm font-semibold text-slate-900 mb-4 flex items-center">
                            <i class="fa-solid fa-triangle-exclamation mr-2 text-slate-500"></i> Error Summary
                        </h3>
                        <div class="space-y-2">
                            <div class="flex justify-between text-sm">
                                <span class="text-slate-600">Critical (Last 24h)</span>
                                <span class="font-medium text-logCritical">0</span>
                            </div>
                            <div class="flex justify-between text-sm">
                                <span class="text-slate-600">Errors (Last 24h)</span>
                                <span class="font-medium text-logError">12</span>
                            </div>
                            <div class="flex justify-between text-sm">
                                <span class="text-slate-600">Warnings (Last 24h)</span>
                                <span class="font-medium text-logWarning">47</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="config-card">
                        <h3 class="text-sm font-semibold text-slate-900 mb-4 flex items-center">
                            <i class="fa-solid fa-clock mr-2 text-slate-500"></i> Last Rotation
                        </h3>
                        <div class="space-y-2">
                            <div class="flex justify-between text-sm">
                                <span class="text-slate-600">Last Rotation</span>
                                <span class="font-medium">2 hours ago</span>
                            </div>
                            <div class="flex justify-between text-sm">
                                <span class="text-slate-600">Next Rotation</span>
                                <span class="font-medium">~22 hours</span>
                            </div>
                            <div class="flex justify-between text-sm">
                                <span class="text-slate-600">Oldest Log</span>
                                <span class="font-medium">14 days ago</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Configuration Sections -->
                <div class="space-y-6">
                    <!-- Section 1: Logging Master Control -->
                    <section class="config-card">
                        <div class="config-card-header">
                            <h2 class="text-lg font-semibold text-slate-800 flex items-center">
                                <i class="fa-solid fa-sliders mr-3 text-primary"></i>
                                Logging Master Control
                            </h2>
                            <p class="text-sm text-slate-600 mt-1">Master controls for the entire logging system</p>
                        </div>
                        
                        <div class="space-y-6">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <!-- Enable Logging -->
                                <div class="flex items-center justify-between">
                                    <div>
                                        <label class="block text-sm font-medium text-slate-900 mb-1">Enable Device Logging</label>
                                        <p class="text-xs text-slate-500">Master toggle for entire logging system</p>
                                    </div>
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="enableLogging" checked>
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                                
                                <!-- Log Level -->
                                <div>
                                    <label class="block text-sm font-medium text-slate-900 mb-1">Log Level</label>
                                    <p class="text-xs text-slate-500 mb-2">Determines verbosity</p>
                                    <select class="w-full compact-select" id="logLevel">
                                        <option value="critical">CRITICAL (system crash, corruption)</option>
                                        <option value="error">ERROR (Modbus timeout, CAN errors, app failures)</option>
                                        <option value="warning">WARN (high CPU, storage warnings, unstable connection)</option>
                                        <option value="info" selected>INFO (normal operation logs)</option>
                                        <option value="debug">DEBUG (deep debugging - high volume)</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <!-- Max Storage -->
                                <div>
                                    <label class="block text-sm font-medium text-slate-900 mb-1">Max Storage</label>
                                    <p class="text-xs text-slate-500 mb-2">Storage reserved for logs</p>
                                    <div class="flex items-center space-x-3">
                                        <input type="number" min="10" max="1000" value="300" class="compact-input flex-1" id="maxStorage">
                                        <span class="text-sm text-slate-600">MB</span>
                                    </div>
                                </div>
                                
                                <!-- Rotation Mode -->
                                <div>
                                    <label class="block text-sm font-medium text-slate-900 mb-1">Rotation Mode</label>
                                    <p class="text-xs text-slate-500 mb-2">How logs handle overflow</p>
                                    <select class="w-full compact-select" id="rotationMode">
                                        <option value="fifo">FIFO (delete oldest first)</option>
                                        <option value="compress">Compress old logs to archive</option>
                                        <option value="delete">Delete when full (no compression)</option>
                                        <option value="fifo-compress">FIFO + Compress (recommended)</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- Section 2: Log Categories -->
                    <section class="config-card">
                        <div class="config-card-header">
                            <h2 class="text-lg font-semibold text-slate-800 flex items-center">
                                <i class="fa-solid fa-list-check mr-3 text-primary"></i>
                                Log Categories
                            </h2>
                            <p class="text-sm text-slate-600 mt-1">Select which subsystems to log</p>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                            <!-- System Logs -->
                            <label class="flex items-start space-x-3 p-3 border border-slate-200 rounded-lg hover:bg-slate-50 cursor-pointer">
                                <input type="checkbox" class="mt-1 rounded border-slate-300 text-primary focus:ring-primary" checked id="systemLogs">
                                <div>
                                    <div class="font-medium text-slate-900">System Logs</div>
                                    <div class="text-xs text-slate-500 mt-1">Kernel, watchdog, crash reports</div>
                                </div>
                            </label>
                            
                            <!-- Network Logs -->
                            <label class="flex items-start space-x-3 p-3 border border-slate-200 rounded-lg hover:bg-slate-50 cursor-pointer">
                                <input type="checkbox" class="mt-1 rounded border-slate-300 text-primary focus:ring-primary" checked id="networkLogs">
                                <div>
                                    <div class="font-medium text-slate-900">Network Logs</div>
                                    <div class="text-xs text-slate-500 mt-1">Ethernet, Wi-Fi, 4G, packet drops</div>
                                </div>
                            </label>
                            
                            <!-- CAN Bus Logs -->
                            <label class="flex items-start space-x-3 p-3 border border-slate-200 rounded-lg hover:bg-slate-50 cursor-pointer">
                                <input type="checkbox" class="mt-1 rounded border-slate-300 text-primary focus:ring-primary" checked id="canLogs">
                                <div>
                                    <div class="font-medium text-slate-900">CAN Bus Logs</div>
                                    <div class="text-xs text-slate-500 mt-1">RX/TX errors, invalid frames</div>
                                </div>
                            </label>
                            
                            <!-- Modbus Logs -->
                            <label class="flex items-start space-x-3 p-3 border border-slate-200 rounded-lg hover:bg-slate-50 cursor-pointer">
                                <input type="checkbox" class="mt-1 rounded border-slate-300 text-primary focus:ring-primary" checked id="modbusLogs">
                                <div>
                                    <div class="font-medium text-slate-900">Modbus Logs</div>
                                    <div class="text-xs text-slate-500 mt-1">Read/write errors, poll failures</div>
                                </div>
                            </label>
                            
                            <!-- MQTT Internal Logs -->
                            <label class="flex items-start space-x-3 p-3 border border-slate-200 rounded-lg hover:bg-slate-50 cursor-pointer">
                                <input type="checkbox" class="mt-1 rounded border-slate-300 text-primary focus:ring-primary" checked id="mqttLogs">
                                <div>
                                    <div class="font-medium text-slate-900">MQTT Internal Logs</div>
                                    <div class="text-xs text-slate-500 mt-1">Connection, publish/subscribe errors</div>
                                </div>
                            </label>
                            
                            <!-- Security Logs -->
                            <label class="flex items-start space-x-3 p-3 border border-slate-200 rounded-lg hover:bg-slate-50 cursor-pointer">
                                <input type="checkbox" class="mt-1 rounded border-slate-300 text-primary focus:ring-primary" checked id="securityLogs">
                                <div>
                                    <div class="font-medium text-slate-900">Security Logs</div>
                                    <div class="text-xs text-slate-500 mt-1">SSH, login attempts, unauthorized access</div>
                                </div>
                            </label>
                            
                            <!-- Sensor/GPIO Driver Logs -->
                            <label class="flex items-start space-x-3 p-3 border border-slate-200 rounded-lg hover:bg-slate-50 cursor-pointer">
                                <input type="checkbox" class="mt-1 rounded border-slate-300 text-primary focus:ring-primary" id="sensorLogs">
                                <div>
                                    <div class="font-medium text-slate-900">Sensor/GPIO Driver Logs</div>
                                    <div class="text-xs text-slate-500 mt-1">Hardware sensor communication</div>
                                </div>
                            </label>
                            
                            <!-- Rule Engine Diagnostic Logs -->
                            <label class="flex items-start space-x-3 p-3 border border-slate-200 rounded-lg hover:bg-slate-50 cursor-pointer">
                                <input type="checkbox" class="mt-1 rounded border-slate-300 text-primary focus:ring-primary" id="ruleEngineLogs">
                                <div>
                                    <div class="font-medium text-slate-900">Rule Engine Diagnostic Logs</div>
                                    <div class="text-xs text-slate-500 mt-1">Low-level rule execution details</div>
                                </div>
                            </label>
                            
                            <!-- Debug Logs -->
                            <label class="flex items-start space-x-3 p-3 border border-slate-200 rounded-lg hover:bg-slate-50 cursor-pointer">
                                <input type="checkbox" class="mt-1 rounded border-slate-300 text-primary focus:ring-primary" id="debugLogs">
                                <div>
                                    <div class="font-medium text-slate-900">Debug Logs</div>
                                    <div class="text-xs text-slate-500 mt-1">Very high volume - developers only</div>
                                </div>
                            </label>
                        </div>
                        
                        <!-- Quick Actions -->
                        <div class="mt-6 pt-6 border-t border-slate-200 flex space-x-3">
                            <button class="text-sm px-3 py-1.5 font-medium text-slate-700 border border-slate-300 rounded-lg bg-white hover:bg-slate-50" id="selectAllLogs">
                                Select All
                            </button>
                            <button class="text-sm px-3 py-1.5 font-medium text-slate-700 border border-slate-300 rounded-lg bg-white hover:bg-slate-50" id="deselectAllLogs">
                                Deselect All
                            </button>
                        </div>
                    </section>

                    <!-- Section 3: Logging Output Destinations -->
                    <section class="config-card">
                        <div class="config-card-header">
                            <h2 class="text-lg font-semibold text-slate-800 flex items-center">
                                <i class="fa-solid fa-location-arrow mr-3 text-primary"></i>
                                Logging Output Destinations
                            </h2>
                            <p class="text-sm text-slate-600 mt-1">Where logs will be stored or streamed</p>
                        </div>
                        
                        <div class="space-y-6">
                            <!-- Local Storage -->
                            <div class="flex items-center justify-between">
                                <div>
                                    <div class="font-medium text-slate-900">Local Storage</div>
                                    <div class="text-sm text-slate-500">Default debugging location (/var/log)</div>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="localStorage" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            
                            <!-- External USB Storage -->
                            <div class="flex items-center justify-between">
                                <div>
                                    <div class="font-medium text-slate-900">External USB Storage</div>
                                    <div class="text-sm text-slate-500">Field engineers onsite collection</div>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="usbStorage">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            
                            <!-- Cloud Upload Endpoint -->
                            <div>
                                <label class="block text-sm font-medium text-slate-900 mb-1">Cloud Upload Endpoint</label>
                                <p class="text-xs text-slate-500 mb-2">For cloud dashboards and remote monitoring</p>
                                <input type="url" class="w-full compact-input" placeholder="https://logs.yourcloud.com/api/v1/logs" id="cloudEndpoint">
                            </div>
                            
                            <!-- Syslog Server -->
                            <div>
                                <label class="block text-sm font-medium text-slate-900 mb-1">Syslog Server</label>
                                <p class="text-xs text-slate-500 mb-2">Industrial IT environments (IP:Port)</p>
                                <input type="text" class="w-full compact-input" placeholder="192.168.1.100:514" id="syslogServer">
                            </div>
                            
                            <!-- MQTT Topic Output -->
                            <div>
                                <label class="block text-sm font-medium text-slate-900 mb-1">MQTT Topic Output</label>
                                <p class="text-xs text-slate-500 mb-2">Pipe logs to external monitoring systems</p>
                                <input type="text" class="w-full compact-input" placeholder="iot/device/logs" value="iot/device/logs" id="mqttTopic">
                            </div>
                            
                            <!-- WebSocket Streaming -->
                            <div class="flex items-center justify-between">
                                <div>
                                    <div class="font-medium text-slate-900">WebSocket Streaming</div>
                                    <div class="text-sm text-slate-500">Enable live log viewer in Web UI</div>
                                </div>
                                <button class="compact-button bg-primary hover:bg-primaryHover text-white" id="enableWebSocket">
                                    <i class="fa-solid fa-play mr-2"></i> Enable Streaming
                                </button>
                            </div>
                        </div>
                    </section>

                    <!-- Section 4: Log Rotation -->
                    <section class="config-card">
                        <div class="config-card-header">
                            <h2 class="text-lg font-semibold text-slate-800 flex items-center">
                                <i class="fa-solid fa-rotate-right mr-3 text-primary"></i>
                                Log Rotation
                            </h2>
                            <p class="text-sm text-slate-600 mt-1">Configure log file management</p>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <!-- Max Log File Size -->
                            <div>
                                <label class="block text-sm font-medium text-slate-900 mb-1">Max Log File Size</label>
                                <p class="text-xs text-slate-500 mb-2">Individual log file size limit</p>
                                <div class="flex items-center space-x-3">
                                    <input type="number" min="1" max="100" value="20" class="compact-input flex-1" id="maxFileSize">
                                    <span class="text-sm text-slate-600">MB</span>
                                </div>
                            </div>
                            
                            <!-- Max Log Files -->
                            <div>
                                <label class="block text-sm font-medium text-slate-900 mb-1">Max Log Files</label>
                                <p class="text-xs text-slate-500 mb-2">Number of log files to keep</p>
                                <input type="number" min="1" max="100" value="10" class="w-full compact-input" id="maxLogFiles">
                            </div>
                        </div>
                        
                        <div class="mt-6 space-y-4">
                            <!-- Compress Older Files -->
                            <div class="flex items-center justify-between">
                                <div>
                                    <div class="font-medium text-slate-900">Compress Older Files</div>
                                    <div class="text-sm text-slate-500">Gzip compress logs older than 7 days</div>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="compressLogs" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            
                            <!-- Delete Oldest When Full -->
                            <div class="flex items-center justify-between">
                                <div>
                                    <div class="font-medium text-slate-900">Delete Oldest When Full</div>
                                    <div class="text-sm text-slate-500">Automatically delete oldest logs when storage is full</div>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="deleteOldest" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                    </section>

                    <!-- Section 5: Manual Tools -->
                    <section class="config-card">
                        <div class="config-card-header">
                            <h2 class="text-lg font-semibold text-slate-800 flex items-center">
                                <i class="fa-solid fa-screwdriver-wrench mr-3 text-primary"></i>
                                Manual Tools
                            </h2>
                            <p class="text-sm text-slate-600 mt-1">Manual log management tools</p>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <!-- View Live Logs -->
                            <div class="p-4 border border-slate-200 rounded-lg">
                                <div class="flex items-center mb-3">
                                    <div class="w-10 h-10 rounded-lg bg-blue-100 flex items-center justify-center mr-3">
                                        <i class="fa-solid fa-terminal text-blue-600"></i>
                                    </div>
                                    <div>
                                        <div class="font-medium text-slate-900">View Live Logs</div>
                                        <div class="text-xs text-slate-500">Real-time tail window</div>
                                    </div>
                                </div>
                                <button class="w-full compact-button border border-slate-300 text-slate-700 hover:bg-slate-50 mt-2" id="openLiveLogsBtn">
                                    Open Live Viewer
                                </button>
                            </div>
                            
                            <!-- Download Logs -->
                            <div class="p-4 border border-slate-200 rounded-lg">
                                <div class="flex items-center mb-3">
                                    <div class="w-10 h-10 rounded-lg bg-green-100 flex items-center justify-center mr-3">
                                        <i class="fa-solid fa-download text-green-600"></i>
                                    </div>
                                    <div>
                                        <div class="font-medium text-slate-900">Download Logs</div>
                                        <div class="text-xs text-slate-500">ZIP export of all logs</div>
                                    </div>
                                </div>
                                <button class="w-full compact-button border border-slate-300 text-slate-700 hover:bg-slate-50 mt-2" id="downloadAllLogsBtn">
                                    Download Now
                                </button>
                            </div>
                            
                            <!-- Clear All Logs -->
                            <div class="p-4 border border-slate-200 rounded-lg">
                                <div class="flex items-center mb-3">
                                    <div class="w-10 h-10 rounded-lg bg-red-100 flex items-center justify-center mr-3">
                                        <i class="fa-solid fa-trash text-red-600"></i>
                                    </div>
                                    <div>
                                        <div class="font-medium text-slate-900">Clear All Logs</div>
                                        <div class="text-xs text-slate-500">Free storage space</div>
                                    </div>
                                </div>
                                <button class="w-full compact-button border border-red-300 text-red-600 hover:bg-red-50 mt-2" id="clearAllLogsBtn">
                                    Clear Logs
                                </button>
                            </div>
                        </div>
                    </section>
                </div>
            </div>
        </main>

        <!-- Footer Actions -->
        <footer id="footer" class="bg-white border-t border-border mt-12 sticky bottom-0 z-40 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.05)]">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-20 flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button class="bg-white border border-slate-300 text-slate-700 hover:bg-slate-50 font-medium text-sm px-4 py-2 rounded-lg shadow-sm transition-colors flex items-center" id="testLoggingBtn">
                        <i class="fa-solid fa-vial mr-2 text-slate-400"></i> Test Configuration
                    </button>
                    <button class="bg-white border border-slate-300 text-slate-700 hover:bg-slate-50 font-medium text-sm px-4 py-2 rounded-lg shadow-sm transition-colors flex items-center" id="rotateNowBtn">
                        <i class="fa-solid fa-rotate-right mr-2 text-slate-400"></i> Rotate Logs Now
                    </button>
                </div>
                <div class="flex items-center space-x-3">
                    <button class="text-slate-500 hover:text-red-600 font-medium text-sm px-4 py-2 rounded-lg hover:bg-red-50 transition-colors flex items-center">
                        <i class="fa-solid fa-rotate-left mr-2"></i> Reset to Default
                    </button>
                    <div class="h-6 w-px bg-slate-200 mx-1"></div>
                    <button class="text-red-600 hover:text-red-700 hover:bg-red-50 font-medium text-sm px-4 py-2 rounded-lg transition-colors flex items-center">
                        <i class="fa-solid fa-power-off mr-2"></i> Restart Logger
                    </button>
                    <div class="h-6 w-px bg-slate-200 mx-1"></div>
                    <button class="bg-white border border-slate-300 text-slate-700 hover:bg-slate-50 font-medium text-sm px-5 py-2 rounded-lg shadow-sm transition-colors" id="footer-cancel-btn">
                        Cancel
                    </button>
                    <button class="bg-primary hover:bg-primaryHover text-white font-medium text-sm px-6 py-2 rounded-lg shadow-sm transition-colors flex items-center shadow-lg shadow-blue-500/30" id="footer-save-btn">
                        <i class="fa-solid fa-floppy-disk mr-2"></i> Save Logging Configuration
                    </button>
                </div>
            </div>
        </footer>
    </div> <!-- End of main content container -->

    <script>
        // SIDEBAR LOADING
        async function loadSidebar() {
            try {
                const response = await fetch('sidebar.html');
                if (!response.ok) {
                    throw new Error(`Failed to load sidebar: ${response.status}`);
                }
                
                const html = await response.text();
                document.getElementById('sidebar-container').innerHTML = html;
                
                // Initialize sidebar after loading
                initializeSidebar();
                
            } catch (error) {
                console.error('Error loading sidebar:', error);
                createFallbackSidebar();
            }
        }

        function createFallbackSidebar() {
            const fallbackHTML = `
                <div class="sidebar" id="sidebar">
                    <div class="sidebar-logo">
                        <div class="logo-text">
                            <i class="fa-solid fa-satellite-dish mr-2"></i> Innospace
                        </div>
                    </div>
                    <div class="sidebar-nav">
                        <div class="nav-section">
                            <div class="section-title">Configuration</div>
                            <a href="general-configuration.html" class="nav-item">
                                <i class="fa-solid fa-sliders"></i> General Configuration
                            </a>
                            <a href="device-management.html" class="nav-item">
                                <i class="fa-solid fa-microchip"></i> Device Management
                            </a>
                            <a href="protocol-mapping.html" class="nav-item">
                                <i class="fa-solid fa-plug"></i> Protocol Mapping
                            </a>
                            <a href="logging.html" class="nav-item active">
                                <i class="fa-solid fa-file-lines"></i> Device Logging
                                <span class="nav-item-count">New</span>
                            </a>
                        </div>
                        
                        <div class="nav-section">
                            <div class="section-title">Monitoring</div>
                            <a href="dashboard.html" class="nav-item">
                                <i class="fa-solid fa-gauge"></i> Dashboard
                            </a>
                            <a href="analytics.html" class="nav-item">
                                <i class="fa-solid fa-chart-line"></i> Analytics
                            </a>
                        </div>
                    </div>
                    <div class="sidebar-footer">
                        <div class="user-profile">
                            <div class="user-avatar">A</div>
                            <div class="user-info">
                                <h4>Admin</h4>
                                <p>System Admin</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="sidebar-toggle" id="sidebarToggle">
                    <i class="fa-solid fa-bars"></i>
                </div>
            `;
            
            document.getElementById('sidebar-container').innerHTML = fallbackHTML;
            initializeSidebar();
        }

        function initializeSidebar() {
            const sidebar = document.getElementById('sidebar');
            const sidebarToggle = document.getElementById('sidebarToggle');
            
            if (!sidebar || !sidebarToggle) return;
            
            sidebarToggle.addEventListener('click', function() {
                sidebar.classList.toggle('active');
                const icon = this.querySelector('i');
                icon.className = sidebar.classList.contains('active') 
                    ? 'fa-solid fa-times' 
                    : 'fa-solid fa-bars';
            });
            
            if (window.innerWidth <= 1024) {
                sidebar.classList.add('active');
                sidebarToggle.style.left = '260px';
                sidebarToggle.querySelector('i').className = 'fa-solid fa-times';
            }
            
            window.addEventListener('resize', handleResponsive);
        }

        function handleResponsive() {
            const sidebar = document.getElementById('sidebar');
            const sidebarToggle = document.getElementById('sidebarToggle');
            
            if (window.innerWidth <= 1024) {
                sidebar.classList.remove('active');
                sidebarToggle.style.display = 'block';
                sidebarToggle.style.left = '0';
                sidebarToggle.querySelector('i').className = 'fa-solid fa-bars';
            } else {
                sidebar.classList.remove('collapsed', 'active');
                sidebarToggle.style.display = 'none';
                sidebarToggle.style.left = '260px';
            }
        }

        // Logging Application Code
        let liveLogInterval = null;
        let isLiveLogPaused = false;
        let logLines = [];

        // Sample log data
        const sampleLogs = [
            { time: '14:23:45', level: 'INFO', module: 'System', message: 'Gateway boot complete, firmware v2.1.4' },
            { time: '14:23:46', level: 'INFO', module: 'Network', message: 'Ethernet link up on eth0, 100Mbps full duplex' },
            { time: '14:23:47', level: 'INFO', module: 'CAN', message: 'CAN bus initialized, 500kbps, listening on can0' },
            { time: '14:23:48', level: 'INFO', module: 'Modbus', message: 'Modbus TCP server started on port 502' },
            { time: '14:24:10', level: 'WARNING', module: 'CAN', message: 'CAN error frame detected on can0, error count: 2' },
            { time: '14:24:15', level: 'ERROR', module: 'Modbus', message: 'Timeout reading from device LoadCell_1 at address 40001' },
            { time: '14:24:20', level: 'INFO', module: 'Network', message: 'Wi-Fi connection established to "Site-WiFi", RSSI: -65dBm' },
            { time: '14:24:30', level: 'CRITICAL', module: 'System', message: 'Watchdog triggered, system stability issue detected' },
            { time: '14:24:35', level: 'DEBUG', module: 'MQTT', message: 'Publishing telemetry: {"temp": 42.5, "load": 12.3}' },
            { time: '14:24:40', level: 'INFO', module: 'Security', message: 'SSH login successful from 192.168.1.100' },
            { time: '14:25:00', level: 'WARNING', module: 'System', message: 'CPU usage above threshold: 85%' },
            { time: '14:25:10', level: 'ERROR', module: 'Network', message: 'DNS resolution failed for api.cloud-server.com' },
            { time: '14:25:15', level: 'INFO', module: 'CAN', message: 'Received J1939 message: PGN 61444 from address 0x32' },
            { time: '14:25:20', level: 'DEBUG', module: 'Modbus', message: 'Poll cycle complete: 12 registers read, 2 coils written' },
            { time: '14:25:25', level: 'INFO', module: 'System', message: 'Memory usage: 156MB/512MB (30%)' },
            { time: '14:25:30', level: 'WARNING', module: 'Network', message: '4G signal weak: RSSI -105dBm, searching for better cell' },
            { time: '14:25:35', level: 'INFO', module: 'MQTT', message: 'Connected to broker mqtt.broker.com:8883' },
            { time: '14:25:40', level: 'ERROR', module: 'CAN', message: 'CAN bus off error detected, resetting controller' },
            { time: '14:25:45', level: 'INFO', module: 'Security', message: 'Failed login attempt from 192.168.1.150' },
            { time: '14:25:50', level: 'DEBUG', module: 'Sensor', message: 'GPIO pin 17 state changed to HIGH' },
        ];

        // Initialize application
        function initApp() {
            setupEventListeners();
            updateStorageProgress();
        }

        // Update storage progress bar
        function updateStorageProgress() {
            const storageUsed = 156; // Current usage in MB
            const storageTotal = parseInt(document.getElementById('maxStorage').value) || 300;
            const percentage = (storageUsed / storageTotal) * 100;
            
            const progressFill = document.querySelector('.storage-progress-fill');
            if (progressFill) {
                progressFill.style.width = `${percentage}%`;
                
                // Update color based on percentage
                if (percentage < 70) {
                    progressFill.className = 'storage-progress-fill low';
                } else if (percentage < 90) {
                    progressFill.className = 'storage-progress-fill medium';
                } else {
                    progressFill.className = 'storage-progress-fill high';
                }
            }
        }

        // Generate a random log entry
        function generateRandomLog() {
            const levels = ['INFO', 'WARNING', 'ERROR', 'DEBUG'];
            const modules = ['System', 'Network', 'CAN', 'Modbus', 'MQTT', 'Security', 'Sensor'];
            const messages = [
                'Normal operation',
                'Signal strength: -75dBm',
                'CAN frame received',
                'Modbus poll complete',
                'MQTT publish successful',
                'Login attempt detected',
                'Temperature reading: 24.5C',
                'Memory usage stable',
                'Network packet sent',
                'Watchdog check passed'
            ];
            
            const now = new Date();
            const time = now.toTimeString().split(' ')[0];
            const level = levels[Math.floor(Math.random() * levels.length)];
            const module = modules[Math.floor(Math.random() * modules.length)];
            const message = messages[Math.floor(Math.random() * messages.length)];
            
            return { time, level, module, message };
        }

        // Add a log line to the viewer
        function addLogLine(log) {
            const logViewer = document.getElementById('logViewer');
            if (!logViewer) return;
            
            // Check filters
            const filters = {
                critical: document.getElementById('filterCritical')?.checked,
                error: document.getElementById('filterError')?.checked,
                warning: document.getElementById('filterWarning')?.checked,
                info: document.getElementById('filterInfo')?.checked,
                debug: document.getElementById('filterDebug')?.checked
            };
            
            const levelMap = {
                'CRITICAL': 'critical',
                'ERROR': 'error',
                'WARNING': 'warning',
                'INFO': 'info',
                'DEBUG': 'debug'
            };
            
            if (!filters[levelMap[log.level]]) {
                return;
            }
            
            // Check search filter
            const searchTerm = document.getElementById('logSearch')?.value.toLowerCase();
            if (searchTerm) {
                const logText = `${log.time} ${log.level} ${log.module} ${log.message}`.toLowerCase();
                if (!logText.includes(searchTerm)) {
                    return;
                }
            }
            
            // Create log line element
            const logLine = document.createElement('div');
            logLine.className = 'log-line flex';
            
            // Determine color based on log level
            let levelColor = 'text-slate-400';
            let badgeClass = 'log-badge ';
            
            switch(log.level) {
                case 'CRITICAL':
                    levelColor = 'text-red-400';
                    badgeClass += 'critical';
                    break;
                case 'ERROR':
                    levelColor = 'text-red-300';
                    badgeClass += 'error';
                    break;
                case 'WARNING':
                    levelColor = 'text-yellow-400';
                    badgeClass += 'warning';
                    break;
                case 'INFO':
                    levelColor = 'text-blue-400';
                    badgeClass += 'info';
                    break;
                case 'DEBUG':
                    levelColor = 'text-slate-500';
                    badgeClass += 'debug';
                    break;
            }
            
            logLine.innerHTML = `
                <div class="log-time ${levelColor}">${log.time}</div>
                <div class="log-level mx-2">
                    <span class="${badgeClass}">${log.level}</span>
                </div>
                <div class="log-module text-purple-400">${log.module}</div>
                <div class="log-message ml-4 text-slate-300">${log.message}</div>
            `;
            
            logViewer.appendChild(logLine);
            logLines.push(logLine);
            
            // Keep only last 50 lines
            if (logLines.length > 50) {
                const oldest = logLines.shift();
                if (oldest && oldest.parentNode) {
                    oldest.parentNode.removeChild(oldest);
                }
            }
            
            // Update count
            const logCount = document.getElementById('logCount');
            if (logCount) {
                const count = parseInt(logCount.textContent) || 0;
                logCount.textContent = `${count + 1} logs`;
            }
            
            // Auto-scroll to bottom
            logViewer.scrollTop = logViewer.scrollHeight;
        }

        // Start live log simulation
        function startLiveLogs() {
            if (liveLogInterval) clearInterval(liveLogInterval);
            
            // Clear existing logs
            const logViewer = document.getElementById('logViewer');
            if (logViewer) {
                logViewer.innerHTML = '';
                logLines = [];
            }
            
            // Add initial sample logs
            sampleLogs.forEach(log => addLogLine(log));
            
            // Start adding new logs periodically
            liveLogInterval = setInterval(() => {
                if (!isLiveLogPaused) {
                    addLogLine(generateRandomLog());
                }
            }, 2000);
        }

        // Stop live log simulation
        function stopLiveLogs() {
            if (liveLogInterval) {
                clearInterval(liveLogInterval);
                liveLogInterval = null;
            }
        }

        // Setup event listeners
        function setupEventListeners() {
            // Master controls
            document.getElementById('enableLogging').addEventListener('change', function() {
                console.log('Logging enabled:', this.checked);
            });
            
            document.getElementById('logLevel').addEventListener('change', function() {
                console.log('Log level changed to:', this.value);
            });
            
            document.getElementById('maxStorage').addEventListener('input', updateStorageProgress);
            
            // Log categories quick actions
            document.getElementById('selectAllLogs').addEventListener('click', function() {
                document.querySelectorAll('#logCategories input[type="checkbox"]').forEach(cb => {
                    cb.checked = true;
                });
            });
            
            document.getElementById('deselectAllLogs').addEventListener('click', function() {
                document.querySelectorAll('#logCategories input[type="checkbox"]').forEach(cb => {
                    cb.checked = false;
                });
            });
            
            // Manual tools
            document.getElementById('openLiveLogsBtn').addEventListener('click', openLiveLogsModal);
            document.getElementById('viewLiveLogsBtn').addEventListener('click', openLiveLogsModal);
            
            document.getElementById('downloadAllLogsBtn').addEventListener('click', function() {
                alert('Downloading all logs... This may take a moment.');
                setTimeout(() => {
                    alert('Log download complete! A ZIP file has been generated.');
                }, 1500);
            });
            
            document.getElementById('downloadLogsBtn').addEventListener('click', function() {
                alert('Preparing log download...');
                setTimeout(() => {
                    alert('Logs downloaded successfully!');
                }, 1000);
            });
            
            document.getElementById('clearAllLogsBtn').addEventListener('click', function() {
                if (confirm('Are you sure you want to clear ALL logs? This action cannot be undone.')) {
                    alert('Clearing all logs...');
                    setTimeout(() => {
                        alert('All logs have been cleared. Storage has been freed.');
                        updateStorageProgress();
                    }, 1000);
                }
            });
            
            // Live log modal controls
            document.getElementById('closeLiveLogsModal').addEventListener('click', closeLiveLogsModal);
            document.getElementById('closeModalBtn').addEventListener('click', closeLiveLogsModal);
            
            document.getElementById('pauseLogsBtn').addEventListener('click', function() {
                isLiveLogPaused = !isLiveLogPaused;
                const icon = this.querySelector('i');
                if (isLiveLogPaused) {
                    icon.className = 'fa-solid fa-play mr-2';
                    this.innerHTML = '<i class="fa-solid fa-play mr-2"></i> Resume';
                } else {
                    icon.className = 'fa-solid fa-pause mr-2';
                    this.innerHTML = '<i class="fa-solid fa-pause mr-2"></i> Pause';
                }
            });
            
            document.getElementById('clearLogsBtn').addEventListener('click', function() {
                const logViewer = document.getElementById('logViewer');
                if (logViewer) {
                    logViewer.innerHTML = '';
                    logLines = [];
                    document.getElementById('logCount').textContent = '0 logs';
                }
            });
            
            document.getElementById('exportLogsBtn').addEventListener('click', function() {
                alert('Exporting visible logs...');
                setTimeout(() => {
                    alert('Logs exported to CSV file.');
                }, 500);
            });
            
            // Live log filters
            document.querySelectorAll('#liveLogsModal input[type="checkbox"]').forEach(cb => {
                cb.addEventListener('change', startLiveLogs);
            });
            
            document.getElementById('logSearch').addEventListener('input', startLiveLogs);
            
            // WebSocket streaming
            document.getElementById('enableWebSocket').addEventListener('click', function() {
                alert('WebSocket streaming enabled! Live logs are now available.');
                this.innerHTML = '<i class="fa-solid fa-check mr-2"></i> Streaming Active';
                this.classList.remove('bg-primary', 'hover:bg-primaryHover');
                this.classList.add('bg-green-600', 'hover:bg-green-700');
            });
            
            // Footer buttons
            document.getElementById('testLoggingBtn').addEventListener('click', function() {
                const btn = this;
                const original = btn.innerHTML;
                btn.innerHTML = '<i class="fa-solid fa-spinner fa-spin mr-2"></i> Testing...';
                btn.disabled = true;
                
                setTimeout(() => {
                    btn.innerHTML = original;
                    btn.disabled = false;
                    alert('Logging configuration test successful! All destinations are reachable.');
                }, 2000);
            });
            
            document.getElementById('rotateNowBtn').addEventListener('click', function() {
                if (confirm('Rotate logs now? Current logs will be archived.')) {
                    const btn = this;
                    const original = btn.innerHTML;
                    btn.innerHTML = '<i class="fa-solid fa-spinner fa-spin mr-2"></i> Rotating...';
                    btn.disabled = true;
                    
                    setTimeout(() => {
                        btn.innerHTML = original;
                        btn.disabled = false;
                        alert('Log rotation complete! Old logs have been archived.');
                    }, 1500);
                }
            });
            
            // Save buttons
            document.getElementById('header-save-btn').addEventListener('click', saveConfiguration);
            document.getElementById('footer-save-btn').addEventListener('click', saveConfiguration);
            
            // Cancel buttons
            document.getElementById('cancel-btn').addEventListener('click', function() {
                if (confirm('Discard all unsaved changes?')) {
                    location.reload();
                }
            });
            
            document.getElementById('footer-cancel-btn').addEventListener('click', function() {
                if (confirm('Discard all unsaved changes?')) {
                    location.reload();
                }
            });
            
            // Gateway select
            document.getElementById('gateway-select').addEventListener('change', function() {
                if (confirm('Switch gateway? Unsaved changes will be lost.')) {
                    location.reload();
                } else {
                    this.value = 'Univa-GW-01';
                }
            });
        }

        // Open live logs modal
        function openLiveLogsModal() {
            document.getElementById('liveLogsModal').classList.add('active');
            startLiveLogs();
        }

        // Close live logs modal
        function closeLiveLogsModal() {
            document.getElementById('liveLogsModal').classList.remove('active');
            stopLiveLogs();
        }

        // Save configuration
        function saveConfiguration() {
            const btns = [document.getElementById('header-save-btn'), document.getElementById('footer-save-btn')];
            btns.forEach(btn => {
                if (btn) {
                    const original = btn.innerHTML;
                    btn.innerHTML = '<i class="fa-solid fa-spinner fa-spin mr-1"></i> Saving...';
                    btn.disabled = true;
                    
                    setTimeout(() => {
                        btn.innerHTML = original;
                        btn.disabled = false;
                    }, 1000);
                }
            });
            
            // Collect configuration
            const config = {
                enabled: document.getElementById('enableLogging').checked,
                logLevel: document.getElementById('logLevel').value,
                maxStorage: document.getElementById('maxStorage').value,
                rotationMode: document.getElementById('rotationMode').value,
                
                categories: {
                    system: document.getElementById('systemLogs').checked,
                    network: document.getElementById('networkLogs').checked,
                    can: document.getElementById('canLogs').checked,
                    modbus: document.getElementById('modbusLogs').checked,
                    mqtt: document.getElementById('mqttLogs').checked,
                    security: document.getElementById('securityLogs').checked,
                    sensor: document.getElementById('sensorLogs').checked,
                    ruleEngine: document.getElementById('ruleEngineLogs').checked,
                    debug: document.getElementById('debugLogs').checked
                },
                
                destinations: {
                    local: document.getElementById('localStorage').checked,
                    usb: document.getElementById('usbStorage').checked,
                    cloud: document.getElementById('cloudEndpoint').value,
                    syslog: document.getElementById('syslogServer').value,
                    mqttTopic: document.getElementById('mqttTopic').value
                },
                
                rotation: {
                    maxFileSize: document.getElementById('maxFileSize').value,
                    maxFiles: document.getElementById('maxLogFiles').value,
                    compress: document.getElementById('compressLogs').checked,
                    deleteOldest: document.getElementById('deleteOldest').checked
                }
            };
            
            console.log('Saving configuration:', config);
            
            setTimeout(() => {
                alert('Logging configuration saved successfully!\n\nChanges will take effect after the logging service restarts.');
            }, 1000);
        }

        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            // Load sidebar first
            loadSidebar();
            
            // Then initialize the app
            initApp();
        });
    </script>
</body>
</html>